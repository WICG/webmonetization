<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="ReSpec 34.1.4" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <style>
      span.example-title {
        text-transform: none;
      }
      :is(aside, div).example,
      div.illegal-example {
        padding: 0.5em;
        margin: 1em 0;
        position: relative;
        clear: both;
      }
      div.illegal-example {
        color: red;
      }
      div.illegal-example p {
        color: #000;
      }
      :is(aside, div).example {
        border-inline-start-width: 0.5em;
        border-inline-start-style: solid;
        border-color: #e0cb52;
        background: #fcfaee;
      }
      aside.example div.example {
        border-inline-start-width: 0.1em;
        border-color: #999;
        background: #fff;
      }
      .example pre {
        background-color: rgba(0, 0, 0, 0.03);
      }
    </style>
    <style>
      .issue-label {
        text-transform: initial;
      }
      .warning > p:first-child {
        margin-block-start: 0;
      }
      .warning {
        padding: 0.5em;
        border-inline-start-width: 0.5em;
        border-inline-start-style: solid;
      }
      span.warning {
        padding: 0.1em 0.5em 0.15em;
      }
      .issue.closed span.issue-number {
        text-decoration: line-through;
      }
      .issue.closed span.issue-number::after {
        content: ' (Closed)';
        font-size: smaller;
      }
      .warning {
        border-color: #f11;
        border-width: 0.2em;
        border-style: solid;
        background: #fbe9e9;
      }
      .warning-title:before {
        content: 'âš ';
        font-size: 1.3em;
        float: left;
        padding-inline-end: 0.3em;
        margin-block-start: -0.3em;
      }
      li.task-list-item {
        list-style: none;
      }
      input.task-list-item-checkbox {
        margin: 0 0.35em 0.25em -1.6em;
        vertical-align: middle;
      }
      .issue a.respec-gh-label {
        padding: 5px;
        margin: 0 2px 0 2px;
        font-size: 10px;
        text-transform: none;
        text-decoration: none;
        font-weight: 700;
        border-radius: 4px;
        position: relative;
        bottom: 2px;
        border: none;
        display: inline-block;
      }
    </style>
    <style>
      pre.idl {
        padding: 1em;
        position: relative;
      }
      pre.idl > code {
        color: #000;
      }
      @media print {
        pre.idl {
          white-space: pre-wrap;
        }
      }
      .idlHeader {
        display: block;
        width: 150px;
        background: #8ccbf2;
        color: #fff;
        font-family: sans-serif;
        font-weight: 700;
        margin: -1em 0 1em -1em;
        height: 28px;
        line-height: 28px;
      }
      .idlHeader a.self-link {
        margin-inline-start: 0.3cm;
        text-decoration: none;
        border-block-end: none;
      }
      .idlID {
        font-weight: 700;
        color: #005a9c;
      }
      .idlType {
        color: #005a9c;
      }
      .idlName {
        color: #ff4500;
      }
      .idlName a {
        color: #ff4500;
        border-block-end: 1px dotted #ff4500;
        text-decoration: none;
      }
      a.idlEnumItem {
        color: #000;
        border-block-end: 1px dotted #ccc;
        text-decoration: none;
      }
      .idlSuperclass {
        font-style: italic;
        color: #005a9c;
      }
      .idlDefaultValue,
      .idlParamName {
        font-style: italic;
      }
      .extAttr {
        color: #666;
      }
      .idlSectionComment {
        color: gray;
      }
      .idlIncludes a {
        font-weight: 700;
      }
      .respec-button-copy-paste:focus {
        text-decoration: none;
        border-color: #51a7e8;
        outline: 0;
        box-shadow: 0 0 5px rgba(81, 167, 232, 0.5);
      }
      .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
        border-color: #51a7e8;
      }
      .respec-button-copy-paste:is(
          :hover,
          :active,
          .zeroclipboard-is-hover,
          .zeroclipboard-is-active
        ) {
        text-decoration: none;
        background-color: #ddd;
        background-image: linear-gradient(#eee, #ddd);
        border-color: #ccc;
      }
      .respec-button-copy-paste:is(
          :active,
          .selected,
          .zeroclipboard-is-active
        ) {
        background-color: #dcdcdc;
        background-image: none;
        border-color: #b5b5b5;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15);
      }
      .respec-button-copy-paste.selected:hover {
        background-color: #cfcfcf;
      }
      .respec-button-copy-paste:is(
          :disabled,
          :disabled:hover,
          .disabled,
          .disabled:hover
        ) {
        color: rgba(102, 102, 102, 0.5);
        cursor: default;
        background-color: rgba(229, 229, 229, 0.5);
        background-image: none;
        border-color: rgba(197, 197, 197, 0.5);
        box-shadow: none;
      }
      @media print {
        .respec-button-copy-paste {
          visibility: hidden;
        }
      }
    </style>
    <style>
      dfn {
        cursor: pointer;
      }
      .dfn-panel {
        position: absolute;
        z-index: 35;
        min-width: 300px;
        max-width: 500px;
        padding: 0.5em 0.75em;
        margin-block-start: 0.6em;
        font-family: 'Helvetica Neue', sans-serif;
        font-size: small;
        background: #fff;
        color: #000;
        box-shadow:
          0 1em 3em -0.4em rgba(0, 0, 0, 0.3),
          0 0 1px 1px rgba(0, 0, 0, 0.05);
        border-radius: 2px;
      }
      .dfn-panel:not(.docked) > .caret {
        position: absolute;
        top: -9px;
      }
      .dfn-panel:not(.docked) > .caret::after,
      .dfn-panel:not(.docked) > .caret::before {
        content: '';
        position: absolute;
        border: 10px solid transparent;
        border-block-start: 0;
        border-block-end: 10px solid #fff;
        top: 0;
      }
      .dfn-panel:not(.docked) > .caret::before {
        border-block-end: 9px solid #a2a9b1;
      }
      .dfn-panel * {
        margin: 0;
      }
      .dfn-panel b {
        display: block;
        color: #000;
        margin-block-start: 0.25em;
      }
      .dfn-panel ul a[href] {
        color: #333;
      }
      .dfn-panel > div {
        display: flex;
      }
      .dfn-panel a.self-link {
        font-weight: 700;
        margin-inline-end: auto;
      }
      .dfn-panel .marker {
        padding: 0.1em;
        margin-inline-start: 0.5em;
        border-radius: 0.2em;
        text-align: center;
        white-space: nowrap;
        font-size: 90%;
        color: #040b1c;
      }
      .dfn-panel .marker.dfn-exported {
        background: #d1edfd;
        box-shadow: 0 0 0 0.125em #1ca5f940;
      }
      .dfn-panel .marker.idl-block {
        background: #8ccbf2;
        box-shadow: 0 0 0 0.125em #0670b161;
      }
      .dfn-panel a:not(:hover) {
        text-decoration: none !important;
        border-block-end: none !important;
      }
      .dfn-panel a[href]:hover {
        border-block-end-width: 1px;
      }
      .dfn-panel ul {
        padding: 0;
      }
      .dfn-panel li {
        margin-inline-start: 1em;
      }
      .dfn-panel.docked {
        position: fixed;
        left: 0.5em;
        top: unset;
        bottom: 2em;
        margin: 0 auto;
        max-width: calc(100vw - 0.75em * 2 - 0.5em - 0.2em * 2);
        max-height: 30vh;
        overflow: auto;
      }
    </style>

    <title>Web Monetization</title>

    <style id="respec-mainstyle">
      @keyframes pop {
        0% {
          transform: scale(1, 1);
        }
        25% {
          transform: scale(1.25, 1.25);
          opacity: 0.75;
        }
        100% {
          transform: scale(1, 1);
        }
      }
      :is(h1, h2, h3, h4, h5, h6, a) abbr {
        border: none;
      }
      dfn {
        font-weight: 700;
      }
      a.internalDFN {
        color: inherit;
        border-block-end: 1px solid #99c;
        text-decoration: none;
      }
      a.externalDFN {
        color: inherit;
        border-block-end: 1px dotted #ccc;
        text-decoration: none;
      }
      a.bibref {
        text-decoration: none;
      }
      .respec-offending-element:target {
        animation: pop 0.25s ease-in-out 0s 1;
      }
      .respec-offending-element,
      a[href].respec-offending-element {
        text-decoration: red wavy underline;
      }
      @supports not (text-decoration: red wavy underline) {
        .respec-offending-element:not(pre) {
          display: inline-block;
        }
        .respec-offending-element {
          background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=)
            bottom repeat-x;
        }
      }
      #references :target {
        background: #eaf3ff;
        animation: pop 0.4s ease-in-out 0s 1;
      }
      cite .bibref {
        font-style: normal;
      }
      a[href].orcid {
        padding-inline: 4px;
      }
      a[href].orcid > svg {
        margin-block-end: -2px;
      }
      .toc a,
      .tof a {
        text-decoration: none;
      }
      a .figno,
      a .secno {
        color: #000;
      }
      ol.tof,
      ul.tof {
        list-style: none outside none;
      }
      .caption {
        margin-block-start: 0.5em;
        font-style: italic;
      }
      table.simple {
        border-spacing: 0;
        border-collapse: collapse;
        border-block-end: 3px solid #005a9c;
      }
      .simple th {
        background: #005a9c;
        color: #fff;
        padding: 3px 5px;
        text-align: left;
      }
      .simple th a {
        color: #fff;
        padding: 3px 5px;
        text-align: left;
      }
      .simple th[scope='row'] {
        background: inherit;
        color: inherit;
        border-block-start: 1px solid #ddd;
      }
      .simple td {
        padding: 3px 10px;
        border-block-start: 1px solid #ddd;
      }
      .simple tr:nth-child(even) {
        background: #f0f6ff;
      }
      .section dd > p:first-child {
        margin-block-start: 0;
      }
      .section dd > p:last-child {
        margin-block-end: 0;
      }
      .section dd {
        margin-block-end: 1em;
      }
      .section dl.attrs dd,
      .section dl.eldef dd {
        margin-block-end: 0;
      }
      #issue-summary > ul {
        column-count: 2;
      }
      #issue-summary li {
        list-style: none;
        display: inline-block;
      }
      details.respec-tests-details {
        margin-inline-start: 1em;
        display: inline-block;
        vertical-align: top;
      }
      details.respec-tests-details > * {
        padding-inline-end: 2em;
      }
      details.respec-tests-details[open] {
        z-index: 999999;
        position: absolute;
        border: thin solid #cad3e2;
        border-radius: 0.3em;
        background-color: #fff;
        padding-block-end: 0.5em;
      }
      details.respec-tests-details[open] > summary {
        border-block-end: thin solid #cad3e2;
        padding-inline-start: 1em;
        margin-block-end: 1em;
        line-height: 2em;
      }
      details.respec-tests-details > ul {
        width: 100%;
        margin-block-start: -0.3em;
      }
      details.respec-tests-details > li {
        padding-inline-start: 1em;
      }
      .self-link:hover {
        opacity: 1;
        text-decoration: none;
        background-color: transparent;
      }
      aside.example .marker > a.self-link {
        color: inherit;
      }
      .header-wrapper {
        display: flex;
        align-items: baseline;
      }
      :is(h2, h3, h4, h5, h6):not(
          #toc > h2,
          #abstract > h2,
          #sotd > h2,
          .head > h2
        ) {
        position: relative;
        left: -0.5em;
      }
      :is(h2, h3, h4, h5, h6):not(#toch2) + a.self-link {
        color: inherit;
        order: -1;
        position: relative;
        left: -1.1em;
        font-size: 1rem;
        opacity: 0.5;
      }
      :is(h2, h3, h4, h5, h6) + a.self-link::before {
        content: 'Â§';
        text-decoration: none;
        color: var(--heading-text);
      }
      :is(h2, h3) + a.self-link {
        top: -0.2em;
      }
      :is(h4, h5, h6) + a.self-link::before {
        color: #000;
      }
      @media (max-width: 767px) {
        dd {
          margin-inline-start: 0;
        }
      }
      @media print {
        .removeOnSave {
          display: none;
        }
      }
    </style>
    <meta
      name="description"
      content="Web Monetization is an API that allows websites to request small
        payments from users facilitated by the browser and the user's Web
        Monetization provider."
    />
    <style>
      .hljs {
        display: block;
        overflow-x: auto;
        padding: 0.5em;
        color: #383a42;
        background: #fafafa;
      }
      .hljs-comment,
      .hljs-quote {
        color: #717277;
        font-style: italic;
      }
      .hljs-doctag,
      .hljs-formula,
      .hljs-keyword {
        color: #a626a4;
      }
      .hljs-deletion,
      .hljs-name,
      .hljs-section,
      .hljs-selector-tag,
      .hljs-subst {
        color: #ca4706;
        font-weight: 700;
      }
      .hljs-literal {
        color: #0b76c5;
      }
      .hljs-addition,
      .hljs-attribute,
      .hljs-meta-string,
      .hljs-regexp,
      .hljs-string {
        color: #42803c;
      }
      .hljs-built_in,
      .hljs-class .hljs-title {
        color: #9a6a01;
      }
      .hljs-attr,
      .hljs-number,
      .hljs-selector-attr,
      .hljs-selector-class,
      .hljs-selector-pseudo,
      .hljs-template-variable,
      .hljs-type,
      .hljs-variable {
        color: #986801;
      }
      .hljs-bullet,
      .hljs-link,
      .hljs-meta,
      .hljs-selector-id,
      .hljs-symbol,
      .hljs-title {
        color: #336ae3;
      }
      .hljs-emphasis {
        font-style: italic;
      }
      .hljs-strong {
        font-weight: 700;
      }
      .hljs-link {
        text-decoration: underline;
      }
    </style>
    <style>
      var {
        position: relative;
        cursor: pointer;
      }
      var[data-type]::after,
      var[data-type]::before {
        position: absolute;
        left: 50%;
        top: -6px;
        opacity: 0;
        transition: opacity 0.4s;
        pointer-events: none;
      }
      var[data-type]::before {
        content: '';
        transform: translateX(-50%);
        border-width: 4px 6px 0 6px;
        border-style: solid;
        border-color: transparent;
        border-block-start-color: #000;
      }
      var[data-type]::after {
        content: attr(data-type);
        transform: translateX(-50%) translateY(-100%);
        background: #000;
        text-align: center;
        font-family: 'Dank Mono', 'Fira Code', monospace;
        font-style: normal;
        padding: 6px;
        border-radius: 3px;
        color: #daca88;
        text-indent: 0;
        font-weight: 400;
      }
      var[data-type]:hover::after,
      var[data-type]:hover::before {
        opacity: 1;
      }
    </style>
    <script id="initialUserConfig" type="application/json">
      {
        "edDraftURI": "https://webmonetization.org/specification",
        "publishDate": "2021-03-17",
        "github": {
          "repoURL": "wicg/webmonetization",
          "branch": "main"
        },
        "editors": [
          {
            "name": "Adrian Hope-Bailie",
            "email": "adrian@coil.com",
            "company": "Coil Technologies Inc.",
            "companyURL": "https://coil.com"
          },
          {
            "name": "Ben Sharafian",
            "email": "ben@coil.com",
            "company": "Coil Technologies Inc.",
            "companyURL": "https://coil.com"
          },
          {
            "name": "Nick Dudfield",
            "company": "Coil Technologies Inc.",
            "companyURL": "https://coil.com"
          }
        ],
        "shortName": "web-monetization",
        "specStatus": "CG-DRAFT",
        "group": "wicg",
        "xref": "web-platform",
        "localBiblio": {
          "Interledger": {
            "title": "Interledger Protocol (ILP)",
            "href": "https://interledger.org/rfcs/0027-interledger-protocol-4/",
            "id": "interledger"
          },
          "SPSP": {
            "title": "Simple Payments Setup Protocol",
            "href": "https://interledger.org/rfcs/0009-simple-payment-setup-protocol",
            "id": "spsp"
          },
          "STREAM": {
            "title": "STREAM",
            "href": "https://interledger.org/rfcs/0029-stream/",
            "id": "stream"
          },
          "Receipt": {
            "title": "STREAM Receipt",
            "href": "https://interledger.org/rfcs/0039-stream-receipts/",
            "id": "receipt"
          }
        },
        "publishISODate": "2021-03-17T00:00:00.000Z",
        "generatedSubtitle": "Draft Community Group Report 17 March 2021"
      }
    </script>
    <link
      rel="stylesheet"
      href="https://www.w3.org/StyleSheets/TR/2021/cg-draft"
    />
  </head>

  <body class="h-entry" data-cite="WEBIDL HTML INFRA URL WEBIDL DOM FETCH">
    <div class="head">
      <h1 id="title" class="title">Web Monetization</h1>
      <p id="w3c-state">
        <a href="https://www.w3.org/standards/types#reports"
          >Draft Community Group Report</a
        >
        <time class="dt-published" datetime="2021-03-17">17 March 2021</time>
      </p>
      <dl>
        <dt>Latest published version:</dt>
        <dd>
          <a href="https://www.w3.org/web-monetization/"
            >https://www.w3.org/web-monetization/</a
          >
        </dd>
        <dt>Latest editor's draft:</dt>
        <dd>
          <a href="https://webmonetization.org/specification"
            >https://webmonetization.org/specification</a
          >
        </dd>

        <dt>Editors:</dt>
        <dd class="editor p-author h-card vcard">
          <span class="p-name fn">Adrian Hope-Bailie</span> (<a
            class="p-org org h-org"
            href="https://coil.com"
            >Coil Technologies Inc.</a
          >)
        </dd>
        <dd class="editor p-author h-card vcard">
          <span class="p-name fn">Ben Sharafian</span> (<a
            class="p-org org h-org"
            href="https://coil.com"
            >Coil Technologies Inc.</a
          >)
        </dd>
        <dd class="editor p-author h-card vcard">
          <span class="p-name fn">Nick Dudfield</span> (<a
            class="p-org org h-org"
            href="https://coil.com"
            >Coil Technologies Inc.</a
          >)
        </dd>

        <dt>Feedback:</dt>
        <dd>
          <a href="https://github.com/wicg/webmonetization/"
            >GitHub wicg/webmonetization</a
          >
          (<a href="https://github.com/wicg/webmonetization/pulls/"
            >pull requests</a
          >,
          <a href="https://github.com/wicg/webmonetization/issues/new/choose"
            >new issue</a
          >,
          <a href="https://github.com/wicg/webmonetization/issues/"
            >open issues</a
          >)
        </dd>
      </dl>

      <p class="copyright">
        <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
          >Copyright</a
        >
        Â© 2021 the Contributors to the Web Monetization Specification,
        published by the
        <a href="https://www.w3.org/groups/cg/wicg"
          >Web Platform Incubator Community Group</a
        >
        under the
        <a href="https://www.w3.org/community/about/agreements/cla/"
          >W3C Community Contributor License Agreement (CLA)</a
        >. A human-readable
        <a href="https://www.w3.org/community/about/agreements/cla-deed/"
          >summary</a
        >
        is available.
      </p>
      <hr title="Separator for header" />
    </div>
    <section id="abstract" class="introductory">
      <h2>Abstract</h2>
      <p>
        Web Monetization is an API that allows websites to request small
        payments from users facilitated by the browser and the user's Web
        Monetization provider.
      </p>
    </section>
    <section id="sotd" class="introductory">
      <h2>Status of This Document</h2>
      <p>
        This specification was published by the
        <a href="https://www.w3.org/groups/cg/wicg"
          >Web Platform Incubator Community Group</a
        >. It is not a W3C Standard nor is it on the W3C Standards Track. Please
        note that under the
        <a href="https://www.w3.org/community/about/agreements/cla/"
          >W3C Community Contributor License Agreement (CLA)</a
        >
        there is a limited opt-out and other conditions apply. Learn more about
        <a href="https://www.w3.org/community/"
          >W3C Community and Business Groups</a
        >.
      </p>
      <div class="warning" id="issue-container-generatedID">
        <div
          role="heading"
          class="warning-title marker"
          id="h-warning"
          aria-level="3"
        >
          <span>Warning</span>
        </div>
        <div class="">
          <p>
            This specification is a work in progress within the community on the
            best shape it should take. Please see the
            <a href="./docs/explainer">explainer</a> for more info.
          </p>
          <p>
            The specification reflects the desired end-state of the Web
            Monetization APIs as currently anticipated and agreed to between the
            contributors. The specification is being prepared here, in this
            format, to collect the input of the Web community and prepare the
            work to ultimately follow the W3C standards track should it have the
            necessary support to do so.
          </p>
          <p>
            For the most accurate reflection of the APIs that have been
            implemented by providers see the
            <a href="./docs/api">API documentation</a>.
          </p>
        </div>
      </div>
      <p>
        <a href="https://github.com/wicg/webmonetization/issues/"
          >GitHub Issues</a
        >
        are preferred for discussion of this specification.
      </p>
    </section>
    <nav id="toc">
      <h2 class="introductory" id="table-of-contents">Table of Contents</h2>
      <ol class="toc">
        <li class="tocline">
          <a class="tocxref" href="#abstract">Abstract</a>
        </li>
        <li class="tocline">
          <a class="tocxref" href="#sotd">Status of This Document</a>
        </li>
        <li class="tocline">
          <a class="tocxref" href="#terminology"
            ><bdi class="secno">1. </bdi>Terminology</a
          >
        </li>
        <li class="tocline">
          <a class="tocxref" href="#goals"><bdi class="secno">2. </bdi>Goals</a>
        </li>
        <li class="tocline">
          <a class="tocxref" href="#relation-to-other-protocols"
            ><bdi class="secno">3. </bdi>Relation to other protocols</a
          >
        </li>
        <li class="tocline">
          <a class="tocxref" href="#extensions-to-the-document-interface"
            ><bdi class="secno">4. </bdi>Extensions to the
            <code>Document</code> interface</a
          >
        </li>
        <li class="tocline">
          <a class="tocxref" href="#flow"><bdi class="secno">5. </bdi>Flow</a>
          <ol class="toc">
            <li class="tocline">
              <a class="tocxref" href="#payment-handler-flow"
                ><bdi class="secno">5.1 </bdi>Payment Handler Flow</a
              >
            </li>
          </ol>
        </li>
        <li class="tocline">
          <a class="tocxref" href="#specification"
            ><bdi class="secno">6. </bdi>Specification</a
          >
          <ol class="toc">
            <li class="tocline">
              <a class="tocxref" href="#meta-tags-set"
                ><bdi class="secno">6.1 </bdi>Meta Tags Set</a
              >
              <ol class="toc">
                <li class="tocline">
                  <a class="tocxref" href="#examples"
                    ><bdi class="secno">6.1.1 </bdi>Examples</a
                  >
                  <ol class="toc">
                    <li class="tocline">
                      <a class="tocxref" href="#web-monetization-meta-tag"
                        ><bdi class="secno">6.1.1.1 </bdi>Web Monetization Meta
                        Tag</a
                      >
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li class="tocline">
              <a class="tocxref" href="#monetization-interface"
                ><bdi class="secno">6.2 </bdi
                ><span
                  data-export=""
                  data-dfn-type="interface"
                  data-idl="interface"
                  data-title="Monetization"
                  data-dfn-for=""
                  ><code>Monetization</code></span
                >
                interface</a
              >
            </li>
            <li class="tocline">
              <a class="tocxref" href="#monetizationstate-enum"
                ><bdi class="secno">6.3 </bdi
                ><span
                  data-export=""
                  data-dfn-type="enum"
                  data-idl="enum"
                  data-title="MonetizationState"
                  data-dfn-for=""
                  ><code>MonetizationState</code></span
                >
                enum</a
              >
            </li>
            <li class="tocline">
              <a class="tocxref" href="#events"
                ><bdi class="secno">6.4 </bdi>Events</a
              >
              <ol class="toc">
                <li class="tocline">
                  <a class="tocxref" href="#summary"
                    ><bdi class="secno">6.4.1 </bdi>
                    Summary
                  </a>
                </li>
                <li class="tocline">
                  <a class="tocxref" href="#monetizationstartevent-interface"
                    ><bdi class="secno">6.4.2 </bdi
                    ><span
                      data-export=""
                      data-dfn-type="interface"
                      data-idl="interface"
                      data-title="MonetizationStartEvent"
                      data-dfn-for=""
                      ><code>MonetizationStartEvent</code></span
                    >
                    interface</a
                  >
                  <ol class="toc">
                    <li class="tocline">
                      <a class="tocxref" href="#constructor"
                        ><bdi class="secno">6.4.2.1 </bdi
                        ><code>constructor()</code></a
                      >
                    </li>
                    <li class="tocline">
                      <a class="tocxref" href="#paymentpointer-attribute"
                        ><bdi class="secno">6.4.2.2 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="attribute"
                          data-idl="attribute"
                          data-title="paymentPointer"
                          data-dfn-for="MonetizationStartEvent"
                          data-type="DOMString"
                          data-lt="paymentPointer"
                          data-local-lt="MonetizationStartEvent.paymentPointer"
                          ><code>paymentPointer</code></span
                        >
                        attribute</a
                      >
                    </li>
                    <li class="tocline">
                      <a class="tocxref" href="#requestid-attribute"
                        ><bdi class="secno">6.4.2.3 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="attribute"
                          data-idl="attribute"
                          data-title="requestId"
                          data-dfn-for="MonetizationStartEvent"
                          data-type="DOMString"
                          data-lt="requestId"
                          data-local-lt="MonetizationStartEvent.requestId"
                          ><code>requestId</code></span
                        >
                        attribute</a
                      >
                    </li>
                    <li class="tocline">
                      <a
                        class="tocxref"
                        href="#monetizationstarteventinit-dictionary"
                        ><bdi class="secno">6.4.2.4 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="dictionary"
                          data-idl="dictionary"
                          data-title="MonetizationStartEventInit"
                          data-dfn-for=""
                          ><code>MonetizationStartEventInit</code></span
                        >
                        dictionary</a
                      >
                    </li>
                  </ol>
                </li>
                <li class="tocline">
                  <a class="tocxref" href="#monetizationprogressevent-interface"
                    ><bdi class="secno">6.4.3 </bdi
                    ><span
                      data-export=""
                      data-dfn-type="interface"
                      data-idl="interface"
                      data-title="MonetizationProgressEvent"
                      data-dfn-for=""
                      ><code>MonetizationProgressEvent</code></span
                    >
                    interface</a
                  >
                  <ol class="toc">
                    <li class="tocline">
                      <a class="tocxref" href="#constructor-0"
                        ><bdi class="secno">6.4.3.1 </bdi
                        ><code>constructor()</code></a
                      >
                    </li>
                    <li class="tocline">
                      <a class="tocxref" href="#amount-attribute"
                        ><bdi class="secno">6.4.3.2 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="attribute"
                          data-idl="attribute"
                          data-title="amount"
                          data-dfn-for="MonetizationProgressEvent"
                          data-type="DOMString"
                          data-lt="amount"
                          data-local-lt="MonetizationProgressEvent.amount"
                          ><code>amount</code></span
                        >
                        attribute</a
                      >
                    </li>
                    <li class="tocline">
                      <a class="tocxref" href="#assetcode-attribute"
                        ><bdi class="secno">6.4.3.3 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="attribute"
                          data-idl="attribute"
                          data-title="assetCode"
                          data-dfn-for="MonetizationProgressEvent"
                          data-type="DOMString"
                          data-lt="assetCode"
                          data-local-lt="MonetizationProgressEvent.assetCode"
                          ><code>assetCode</code></span
                        >
                        attribute</a
                      >
                    </li>
                    <li class="tocline">
                      <a class="tocxref" href="#assetscale-attribute"
                        ><bdi class="secno">6.4.3.4 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="attribute"
                          data-idl="attribute"
                          data-title="assetScale"
                          data-dfn-for="MonetizationProgressEvent"
                          data-type="DOMString"
                          data-lt="assetScale"
                          data-local-lt="MonetizationProgressEvent.assetScale"
                          ><code>assetScale</code></span
                        >
                        attribute</a
                      >
                    </li>
                    <li class="tocline">
                      <a class="tocxref" href="#receipt-attribute"
                        ><bdi class="secno">6.4.3.5 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="attribute"
                          data-idl="attribute"
                          data-title="receipt"
                          data-dfn-for="MonetizationProgressEvent"
                          data-type="DOMString"
                          data-lt="receipt"
                          data-local-lt="MonetizationProgressEvent.receipt"
                          ><code>receipt</code></span
                        >
                        attribute</a
                      >
                    </li>
                    <li class="tocline">
                      <a
                        class="tocxref"
                        href="#monetizationprogresseventinit-dictionary"
                        ><bdi class="secno">6.4.3.6 </bdi
                        ><span
                          data-export=""
                          data-dfn-type="dictionary"
                          data-idl="dictionary"
                          data-title="MonetizationProgressEventInit"
                          data-dfn-for=""
                          ><code>MonetizationProgressEventInit</code></span
                        >
                        dictionary</a
                      >
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li class="tocline">
              <a class="tocxref" href="#http-headers"
                ><bdi class="secno">6.5 </bdi>HTTP Headers</a
              >
              <ol class="toc">
                <li class="tocline">
                  <a class="tocxref" href="#web-monetization-id"
                    ><bdi class="secno">6.5.1 </bdi
                    ><code>Web-Monetization-Id</code></a
                  >
                </li>
              </ol>
            </li>
          </ol>
        </li>
        <li class="tocline">
          <a class="tocxref" href="#conformance"
            ><bdi class="secno">A. </bdi>Conformance</a
          >
        </li>
        <li class="tocline">
          <a class="tocxref" href="#references"
            ><bdi class="secno">B. </bdi>References</a
          >
          <ol class="toc">
            <li class="tocline">
              <a class="tocxref" href="#normative-references"
                ><bdi class="secno">B.1 </bdi>Normative references</a
              >
            </li>
            <li class="tocline">
              <a class="tocxref" href="#informative-references"
                ><bdi class="secno">B.2 </bdi>Informative references</a
              >
            </li>
          </ol>
        </li>
      </ol>
    </nav>
    <section id="terminology">
      <div class="header-wrapper">
        <h2 id="x1-terminology"><bdi class="secno">1. </bdi>Terminology</h2>
        <a
          class="self-link"
          href="#terminology"
          aria-label="Permalink for Section 1."
        ></a>
      </div>

      <dl>
        <dt>
          <dfn
            id="dfn-user"
            tabindex="0"
            aria-haspopup="dialog"
            class="respec-offending-element"
            title='Found definition for "User", but nothing links to it. This is usually a spec bug!'
            data-dfn-type="dfn"
            >User</dfn
          >:
        </dt>
        <dd>the party who is accessing the web-monetized website.</dd>
        <dt>
          <dfn
            id="dfn-website"
            tabindex="0"
            aria-haspopup="dialog"
            class="respec-offending-element"
            title='Found definition for "Website", but nothing links to it. This is usually a spec bug!'
            data-dfn-type="dfn"
            >Website</dfn
          >:
        </dt>
        <dd>the web-monetized website.</dd>
        <dt>
          <dfn
            data-lt="provider|Web Monetization provider"
            id="dfn-provider"
            tabindex="0"
            aria-haspopup="dialog"
            data-dfn-type="dfn"
            >Web Monetization provider</dfn
          >:
        </dt>
        <dd>the party making payments on behalf of the user.</dd>
        <dt>
          <dfn
            id="dfn-web-monetization-receiver"
            tabindex="0"
            aria-haspopup="dialog"
            class="respec-offending-element"
            title='Found definition for "Web Monetization receiver", but nothing links to it. This is usually a spec bug!'
            data-dfn-type="dfn"
            >Web Monetization receiver</dfn
          >:
        </dt>
        <dd>the party receiving payments on behalf of the website.</dd>
        <dt>
          <dfn
            id="dfn-user-agent"
            tabindex="0"
            aria-haspopup="dialog"
            data-dfn-type="dfn"
            >User agent</dfn
          >:
        </dt>
        <dd>the web browser used by the user.</dd>
      </dl>
    </section>
    <section id="goals" class="informative">
      <div class="header-wrapper">
        <h2 id="x2-goals"><bdi class="secno">2. </bdi>Goals</h2>
        <a
          class="self-link"
          href="#goals"
          aria-label="Permalink for Section 2."
        ></a>
      </div>
      <p><em>This section is non-normative.</em></p>

      <ul>
        <li>Should be simple for webmasters to use in their site.</li>
        <li>
          Backend infrastructure should be optional; should be usable on a
          static site.
        </li>
        <li>Interaction with the user should be optional.</li>
        <li>
          The user retains control over how much to spend, and which sites to
          support.
        </li>
        <li>
          Should give advanced webmasters a way to associate payments with their
          users, in order to unlock premium experiences.
        </li>
        <li>Should pay continuously as the user consumes content.</li>
        <li>
          Should be compatible with existing application and transport
          protocols, such as the
          <cite
            ><a
              data-matched-text="[[[Interledger]]]"
              href="https://interledger.org/rfcs/0027-interledger-protocol-4/"
              >Interledger Protocol (ILP)</a
            ></cite
          >.
        </li>
      </ul>
    </section>
    <section id="relation-to-other-protocols" class="informative">
      <div class="header-wrapper">
        <h2 id="x3-relation-to-other-protocols">
          <bdi class="secno">3. </bdi>Relation to other protocols
        </h2>
        <a
          class="self-link"
          href="#relation-to-other-protocols"
          aria-label="Permalink for Section 3."
        ></a>
      </div>
      <p><em>This section is non-normative.</em></p>

      <p>
        The W3C have published two payments related APIs for browsers, the
        <cite
          ><a
            data-matched-text="[[[payment-Request]]]"
            href="https://www.w3.org/TR/payment-request/"
            >Payment Request API</a
          ></cite
        >
        and the
        <cite
          ><a
            data-matched-text="[[[Payment-Handler]]]"
            href="https://www.w3.org/TR/payment-handler/"
            >Payment Handler API</a
          ></cite
        >.
      </p>
      <p>
        The reason this API is not using the
        <cite
          ><a
            data-matched-text="[[[payment-Request]]]"
            href="https://www.w3.org/TR/payment-request/"
            >Payment Request API</a
          ></cite
        >
        directly is that Web Monetization is intended for continuous payments
        rather than discrete payments. It is also designed to <em>not</em> have
        any user interaction: It is intended to provide a direct alternative to
        advertisements, rather than an alternative to traditional e-commerce
        checkout methods.
      </p>
      <p>
        In future, some changes will be required to the
        <cite
          ><a
            data-matched-text="[[[payment-Request]]]"
            href="https://www.w3.org/TR/payment-request/"
            >Payment Request API</a
          ></cite
        >
        and the
        <cite
          ><a
            data-matched-text="[[[Payment-Handler]]]"
            href="https://www.w3.org/TR/payment-handler/"
            >Payment Handler API</a
          ></cite
        >
        to support Web Monetization. This API brings the necessary capabilities
        to user agents in a manner that can integrate with existing payments
        APIs.
      </p>
      <p>
        With advertisements, the user agent decides whether to display the ads
        and the user decides whether to engage with the ads. With Web
        Monetization, the user's provider decides whether to pay the site and,
        if so, how much to pay.
      </p>
      <p>
        Web Monetization makes use of
        <abbr title="Simple Payment Setup Protocol">SPSP</abbr> on top of
        <abbr title="Interledger Protocol">ILP</abbr>/<cite
          ><a
            data-matched-text="[[[STREAM]]]"
            href="https://interledger.org/rfcs/0029-stream/"
            >STREAM</a
          ></cite
        >
        to provide a high-level way to send money and data, while still
        providing tremendous flexibility.
      </p>
    </section>
    <section id="extensions-to-the-document-interface">
      <div class="header-wrapper">
        <h2 id="x4-extensions-to-the-document-interface">
          <bdi class="secno">4. </bdi>Extensions to the
          <code>Document</code> interface
        </h2>
        <a
          class="self-link"
          href="#extensions-to-the-document-interface"
          aria-label="Permalink for Section 4."
        ></a>
      </div>

      <pre
        class="idl def"
        id="webidl-844121115"
      ><span class="idlHeader"><a class="self-link" href="#webidl-844121115">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-document-partial-1" data-title="Document">partial interface <a data-idl="partial" data-link-type="interface" data-title="Document" class="idlID" data-dfn-for="Document" data-type="interface" href="https://dom.spec.whatwg.org/#document">Document</a> {<span data-idl="" class="idlAttribute" id="idl-def-document-monetization" data-title="monetization" data-dfn-for="Document">
  readonly attribute<span class="idlType"> <a data-link-type="idl" href="#dom-monetization" class="internalDFN" id="ref-for-dom-monetization-1"><code>Monetization</code></a></span> <dfn data-export="" data-dfn-type="attribute" id="dom-document-monetization" data-idl="attribute" data-title="monetization" data-dfn-for="Document" data-type="Monetization" data-lt="monetization" data-local-lt="Document.monetization" class="idlName" tabindex="0" aria-haspopup="dialog"><code>monetization</code></dfn>;</span>
};</span></code></pre>
    </section>
    <section id="flow">
      <div class="header-wrapper">
        <h2 id="x5-flow"><bdi class="secno">5. </bdi>Flow</h2>
        <a
          class="self-link"
          href="#flow"
          aria-label="Permalink for Section 5."
        ></a>
      </div>

      <p>
        This flow refers to the
        <a
          href="#dfn-user-agent"
          class="internalDFN"
          data-link-type="dfn"
          id="ref-for-dfn-user-agent-1"
          >user agent</a
        >
        and the user's
        <a
          href="#dfn-provider"
          class="internalDFN"
          data-link-type="dfn"
          id="ref-for-dfn-provider-1"
          >provider</a
        >.
      </p>
      <ol>
        <li>
          The
          <a
            href="#dfn-user-agent"
            class="internalDFN"
            data-link-type="dfn"
            id="ref-for-dfn-user-agent-2"
            >user agent</a
          >
          sets
          <a
            data-link-type="idl"
            href="#dom-monetization-state"
            class="internalDFN"
            id="ref-for-dom-monetization-state-1"
            ><code>state</code></a
          >
          to "<a
            data-link-type="idl"
            href="#dom-monetizationstate-pending"
            class="internalDFN"
            id="ref-for-dom-monetizationstate-pending-1"
            ><code>pending</code></a
          >".
        </li>
        <li>
          <p>
            The
            <a
              href="#dfn-user-agent"
              class="internalDFN"
              data-link-type="dfn"
              id="ref-for-dfn-user-agent-3"
              >user agent</a
            >
            observes the
            <code
              ><a
                data-link-type="element"
                data-type="element"
                href="https://html.spec.whatwg.org/multipage/semantics.html#the-head-element"
                >head</a
              ></code
            >
            and looks for a Web Monetization
            <code>&lt;meta name="monetization"&gt;</code> tag (<a
              href="#meta-tags-set"
              >specified below</a
            >).
          </p>
          <ul>
            <li>
              There <em class="rfc2119">MUST</em> be only one
              <code>&lt;meta name="monetization"&gt;</code> tag at any given
              time
            </li>
            <li>
              The <code>&lt;meta&gt;</code> Tags Set
              <em class="rfc2119">MUST</em> be in the
              <code
                ><a
                  data-link-type="element"
                  data-type="element"
                  href="https://html.spec.whatwg.org/multipage/semantics.html#the-head-element"
                  >head</a
                ></code
              >
              of the document.
            </li>
            <li>
              The <code>&lt;meta&gt;</code> Tags Set
              <em class="rfc2119">MUST</em> be in the top level window (i.e. not
              inside an iframe)
            </li>
          </ul>
        </li>
        <li>
          <p>
            Below is repeated for every semantically (consider
            <code>meta.content = meta.content</code>) new
            <code>&lt;meta name="monetization"&gt;</code> tag seen for the life
            of the page:
          </p>
          <ul>
            <li>
              If any of the Web Monetization <code>&lt;meta&gt;</code> Tags Set
              are malformed, the browser will stop here. The
              <a
                href="#dfn-user-agent"
                class="internalDFN"
                data-link-type="dfn"
                id="ref-for-dfn-user-agent-4"
                >user agent</a
              >
              <em class="rfc2119">SHOULD</em> report a warning via the console.
            </li>
            <li>
              If the Web Monetization
              <code>&lt;meta name="monetization"&gt;</code> tag is well-formed,
              the browser should extract the Payment Setup Endpoint (<a
                href="https://paymentpointers.org"
                >Payment Pointer</a
              >
              or
              <a
                href="https://interledger.org/rfcs/0009-simple-payment-setup-protocol"
                ><abbr title="Simple Payment Setup Protocol">SPSP</abbr></a
              >
              Url).
            </li>
            <li>
              The
              <a
                href="#dfn-user-agent"
                class="internalDFN"
                data-link-type="dfn"
                id="ref-for-dfn-user-agent-5"
                >user agent</a
              >
              generates a fresh <strong>random</strong> UUID (version 4) and
              uses this as a Monetization ID. This
              <em class="rfc2119">MUST</em> be regenerated upon dynamic changes
              to the meta tags and <em class="rfc2119">MUST</em> be unique per
              page load in order to avoid user tracking.
            </li>
            <li>
              The
              <a
                href="#dfn-user-agent"
                class="internalDFN"
                data-link-type="dfn"
                id="ref-for-dfn-user-agent-6"
                >user agent</a
              >
              passes these payment details to the user's provider (see
              <a href="#payment-handler-flow">Payment Handler Flow</a>).
            </li>
            <li>
              The provider resolves the Payment Setup Endpoint and begins to
              pay. The provider <em class="rfc2119">MAY</em> be acting from a
              different machine from the user. Cookies and session information
              <em class="rfc2119">MUST NOT</em> be carried with any requests
              made to resolve the Payment Setup Endpoint, with the exception of
              the Monetization ID.
              <ul>
                <li>
                  With the <code>destination_account</code> and
                  <code>shared_secret</code> fetched from the
                  <abbr title="Simple Payment Setup Protocol">SPSP</abbr> query,
                  a
                  <cite
                    ><a
                      data-matched-text="[[[STREAM]]]"
                      href="https://interledger.org/rfcs/0029-stream/"
                      >STREAM</a
                    ></cite
                  >
                  connection is established. A single
                  <cite
                    ><a
                      data-matched-text="[[[STREAM]]]"
                      href="https://interledger.org/rfcs/0029-stream/"
                      >STREAM</a
                    ></cite
                  >
                  is opened on this connection, and a positive SendMax is set.
                </li>
                <li>
                  The provider <em class="rfc2119">SHOULD</em> set their SendMax
                  high enough that it is never reached, and make payment
                  adjustments by limiting throughput.
                </li>
              </ul>
            </li>
            <li>
              Once the
              <cite
                ><a
                  data-matched-text="[[[STREAM]]]"
                  href="https://interledger.org/rfcs/0029-stream/"
                  >STREAM</a
                ></cite
              >
              connection has fulfilled an
              <abbr title="Interledger Protocol">ILP</abbr> packet with a
              non-zero amount, the provider notifies the browser:
              <ul>
                <li>
                  The
                  <a
                    href="#dfn-user-agent"
                    class="internalDFN"
                    data-link-type="dfn"
                    id="ref-for-dfn-user-agent-7"
                    >user agent</a
                  >
                  sets <code>document.monetization.state</code> to
                  <code>started</code>.
                </li>
                <li>
                  This <em class="rfc2119">MUST</em> occur before the
                  <code>start</code> event is fired.
                </li>
                <li>
                  This event is a
                  <a
                    data-link-type="idl"
                    data-lt="MonetizationStartEvent"
                    href="#dom-monetizationstartevent"
                    class="internalDFN"
                    id="ref-for-dom-monetizationstartevent-1"
                    ><code>MonetizationStartEvent</code></a
                  >
                  containing the Payment Setup Endpoint and the Monetization ID
                  as properties.
                </li>
                <li>
                  The
                  <a
                    href="#dfn-user-agent"
                    class="internalDFN"
                    data-link-type="dfn"
                    id="ref-for-dfn-user-agent-8"
                    >user agent</a
                  >
                  also emits a
                  <a
                    data-link-type="idl"
                    data-lt="progress"
                    href="#dfn-progress"
                    class="internalDFN"
                    id="ref-for-dfn-progress-1"
                    ><code><code>progress</code></code></a
                  >
                  event from <code>document.monetization</code>, corresponding
                  to this first packet.
                </li>
              </ul>
            </li>
            <li>
              Payment continues for the lifetime of a given meta tag (or
              semantically equivalent)
              <ul>
                <li>
                  The provider <em class="rfc2119">MAY</em> decide to stop/start
                  payment at any time, e.g. if the user is idle, backgrounds the
                  page, or instructs the browser to do so.
                </li>
                <li>
                  If the
                  <cite
                    ><a
                      data-matched-text="[[[STREAM]]]"
                      href="https://interledger.org/rfcs/0029-stream/"
                      >STREAM</a
                    ></cite
                  >
                  connection is severed, the provider will redo the
                  <abbr title="Simple Payment Setup Protocol">SPSP</abbr> query
                  to the same Payment Setup Endpoint as before with the same
                  Monetization ID. The
                  <a
                    href="#dfn-user-agent"
                    class="internalDFN"
                    data-link-type="dfn"
                    id="ref-for-dfn-user-agent-9"
                    >user agent</a
                  >
                  <em class="rfc2119">MUST NOT</em> re-process the
                  <code>&lt;meta&gt;</code> Tags Set.
                </li>
                <li>
                  Each time a packet with a non-zero amount is fulfilled, the
                  provider notifies the browser, and the browser emits a
                  <a
                    data-link-type="idl"
                    data-lt="MonetizationProgressEvent"
                    href="#dom-monetizationprogressevent"
                    class="internalDFN"
                    id="ref-for-dom-monetizationprogressevent-1"
                    ><code>MonetizationProgressEvent</code></a
                  >
                  on
                  <code>document.monetization</code>. The event has details of
                  the packet.
                </li>
                <li>
                  When a stream is closed the
                  <code>document.monetization.state</code>
                  <em class="rfc2119">MUST</em> be set back to 'pending'
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ol>
      <section id="payment-handler-flow-0">
        <div class="header-wrapper">
          <h3 id="payment-handler-flow">
            <bdi class="secno">5.1 </bdi>Payment Handler Flow
          </h3>
          <a
            class="self-link"
            href="#payment-handler-flow"
            aria-label="Permalink for Section 5.1"
          ></a>
        </div>
        <p>
          A provider can be implemented as a Payment Handler supporting the
          'webmonetization' payment method (The payment method specification for
          this payment method is still under development as it is dependant on
          changes to the Payment Handler API that support streaming payments).
          Communication between the browser and the provider would use this
          flow.
        </p>
        <ul>
          <li>
            After parsing the <code>&lt;meta&gt;</code> Tags Set, the browser
            creates a new
            <a
              href="https://www.w3.org/TR/payment-request/#paymentrequest-interface"
              >PaymentRequest</a
            >
            object with the following
            <a
              href="https://www.w3.org/TR/payment-request/#dom-paymentmethoddata"
              >PaymentMethodData</a
            >
            argument.
          </li>
        </ul>
        <pre aria-busy="false"><code class="hljs json">{
  <span class="hljs-attr">"supportedMethods"</span>: <span class="hljs-string">"webmonetization"</span>,
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"paymentPointer"</span>: <span class="hljs-string">"&lt;payment pointer parsed from meta tag&gt;"</span>
  }
}</code></pre>
        <ul>
          <li>
            The
            <a
              href="#dfn-user-agent"
              class="internalDFN"
              data-link-type="dfn"
              id="ref-for-dfn-user-agent-10"
              >user agent</a
            >
            calls <code>.show()</code> on this PaymentRequest, triggering the
            <a href="https://www.w3.org/TR/payment-handler/">PaymentHandler</a>
            for <code>webmonetization</code>. This PaymentHandler is how the
            browser communicates to the provider.
            <ul>
              <li>
                The return value of <code>.show()</code>
                <em class="rfc2119">MUST</em> return a Promise, and must also
                implement the
                <a
                  data-link-type="idl"
                  data-lt="EventTarget"
                  data-type="interface"
                  href="https://dom.spec.whatwg.org/#eventtarget"
                  ><code>EventTarget</code></a
                >
                interface. The provider will emit
                <a
                  data-link-type="idl"
                  data-lt="MonetizationStartEvent"
                  href="#dom-monetizationstartevent"
                  class="internalDFN"
                  id="ref-for-dom-monetizationstartevent-2"
                  ><code>MonetizationStartEvent</code></a
                >
                and
                <a
                  data-link-type="idl"
                  data-lt="MonetizationProgressEvent"
                  href="#dom-monetizationprogressevent"
                  class="internalDFN"
                  id="ref-for-dom-monetizationprogressevent-2"
                  ><code>MonetizationProgressEvent</code></a
                >
                events from this Promise to communicate to the browser when
                payment occurs. The Promise
                <em class="rfc2119">MUST NOT</em> resolve, because Web
                Monetization continues for the entire lifetime of a given meta
                tag. The Promise <em class="rfc2119">MAY</em> reject if there is
                an error preventing the provider from paying and no retries will
                occur.
              </li>
              <li>
                This PaymentHandler <em class="rfc2119">MUST NOT</em> require
                any UI or confirmation to proceed with payment.
              </li>
            </ul>
          </li>
        </ul>
      </section>
    </section>
    <section id="specification">
      <div class="header-wrapper">
        <h2 id="x6-specification"><bdi class="secno">6. </bdi>Specification</h2>
        <a
          class="self-link"
          href="#specification"
          aria-label="Permalink for Section 6."
        ></a>
      </div>

      <section id="meta-tags-set">
        <div class="header-wrapper">
          <h3 id="x6-1-meta-tags-set">
            <bdi class="secno">6.1 </bdi>Meta Tags Set
          </h3>
          <a
            class="self-link"
            href="#meta-tags-set"
            aria-label="Permalink for Section 6.1"
          ></a>
        </div>

        <p>
          The <code>&lt;meta&gt;</code> Tags Set
          <em class="rfc2119">MUST</em> be in the document's
          <code
            ><a
              data-link-type="element"
              data-type="element"
              href="https://html.spec.whatwg.org/multipage/semantics.html#the-head-element"
              >head</a
            ></code
          >. The <code>&lt;meta&gt;</code> Tags Set allows the
          <a
            href="#dfn-user-agent"
            class="internalDFN"
            data-link-type="dfn"
            id="ref-for-dfn-user-agent-11"
            >user agent</a
          >
          to pay a site via Web Monetization by specifying a
          <a href="https://paymentpointers.org">Payment Pointer</a> or
          <a
            href="https://interledger.org/rfcs/0009-simple-payment-setup-protocol"
            ><abbr title="Simple Payment Setup Protocol">SPSP</abbr></a
          >
          url.
        </p>
        <p>
          The <code>name</code> of the <code>&lt;meta&gt;</code> tags all start
          with <code>monetization</code>. The table below lists the different
          <code>name</code>s and the formats of their <code>content</code>.
          Currently there is only one tag, but this may be expanded in the
          future so care <em class="rfc2119">MUST</em> be given to altering a
          Tags Set such that <code>&lt;meta name="monetization"&gt;</code> is
          the last one modified.
        </p>
        <div class="overlarge">
          <table class="def data">
            <thead>
              <tr>
                <th>Name</th>
                <th>Required?</th>
                <th>Format</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>monetization</code></td>
                <td>Yes</td>
                <td>Payment Setup Endpoint</td>
                <td>
                  The
                  <a href="https://paymentpointers.org">Payment Pointer</a>
                  or <abbr title="Simple Payment Setup Protocol">SPSP</abbr> url
                  that the
                  <a
                    href="#dfn-user-agent"
                    class="internalDFN"
                    data-link-type="dfn"
                    id="ref-for-dfn-user-agent-12"
                    >user agent</a
                  >
                  will pay to.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <section id="examples-0">
          <div class="header-wrapper">
            <h4 id="examples"><bdi class="secno">6.1.1 </bdi>Examples</h4>
            <a
              class="self-link"
              href="#examples"
              aria-label="Permalink for Section 6.1.1"
            ></a>
          </div>
          <section id="web-monetization-meta-tag-0">
            <div class="header-wrapper">
              <h5 id="web-monetization-meta-tag">
                <bdi class="secno">6.1.1.1 </bdi>Web Monetization Meta Tag
              </h5>
              <a
                class="self-link"
                href="#web-monetization-meta-tag"
                aria-label="Permalink for Section 6.1.1.1"
              ></a>
            </div>
            <div class="example" id="example-1">
              <div class="marker">
                <a class="self-link" href="#example-1">Example<bdi> 1</bdi></a>
              </div>
              <pre
                aria-busy="false"
              ><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"monetization"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"$wallet.example.com/alice"</span>&gt;</span></code></pre>
            </div>
          </section>
        </section>
      </section>
      <section data-dfn-for="Monetization" id="monetization-interface">
        <div class="header-wrapper">
          <h3 id="x6-2-monetization-interface">
            <bdi class="secno">6.2 </bdi
            ><dfn
              data-export=""
              data-dfn-type="interface"
              id="dom-monetization"
              data-idl="interface"
              data-title="Monetization"
              data-dfn-for=""
              tabindex="0"
              aria-haspopup="dialog"
              ><code>Monetization</code></dfn
            >
            interface
          </h3>
          <a
            class="self-link"
            href="#monetization-interface"
            aria-label="Permalink for Section 6.2"
          ></a>
        </div>

        <pre
          class="idl def"
          id="webidl-1263749486"
        ><span class="idlHeader"><a class="self-link" href="#webidl-1263749486">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-monetization" data-title="Monetization">[<span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>, <span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext">SecureContext</a></span>]
interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-monetization" id="ref-for-dom-monetization-2"><code>Monetization</code></a> : <span class="idlSuperclass"><a data-link-type="idl" data-type="interface" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a></span> {<span data-idl="" class="idlAttribute" id="idl-def-monetization-state" data-title="state" data-dfn-for="Monetization">
  readonly attribute<span class="idlType"> <a data-link-type="idl" href="#dom-monetizationstate" class="internalDFN" id="ref-for-dom-monetizationstate-1"><code>MonetizationState</code></a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetization-state" id="ref-for-dom-monetization-state-2"><code>state</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-monetization-onstart" data-title="onstart" data-dfn-for="Monetization">
  attribute<span class="idlType"> <a data-link-type="idl" data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetization-onstart" id="ref-for-dom-monetization-onstart-1"><code>onstart</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-monetization-onprogress" data-title="onprogress" data-dfn-for="Monetization">
  attribute<span class="idlType"> <a data-link-type="idl" data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetization-onprogress" id="ref-for-dom-monetization-onprogress-1"><code>onprogress</code></a>;</span>
};</span></code></pre>
        <dl>
          <dt>
            <dfn
              data-export=""
              data-dfn-type="attribute"
              id="dom-monetization-state"
              data-idl="attribute"
              data-title="state"
              data-dfn-for="Monetization"
              data-type="MonetizationState"
              data-lt="state"
              data-local-lt="Monetization.state"
              tabindex="0"
              aria-haspopup="dialog"
              ><code>state</code></dfn
            >
            attribute
          </dt>
          <dd>
            A
            <a
              data-link-type="idl"
              href="#dom-monetization-state"
              class="internalDFN"
              id="ref-for-dom-monetization-state-3"
              ><code>state</code></a
            >
            attribute exposes the current state of Web Monetization as a
            <a
              data-link-type="idl"
              data-lt="MonetizationState"
              href="#dom-monetizationstate"
              class="internalDFN"
              id="ref-for-dom-monetizationstate-2"
              ><code>MonetizationState</code></a
            >
            enum value.
          </dd>
          <dt>
            <dfn
              data-export=""
              data-dfn-type="attribute"
              id="dom-monetization-onstart"
              data-idl="attribute"
              data-title="onstart"
              data-dfn-for="Monetization"
              data-type="EventHandler"
              data-lt="onstart"
              data-local-lt="Monetization.onstart"
              tabindex="0"
              aria-haspopup="dialog"
              ><code>onstart</code></dfn
            >
            attribute
          </dt>
          <dd>
            A
            <a
              data-link-type="idl"
              href="#dom-monetization-onstart"
              class="internalDFN"
              id="ref-for-dom-monetization-onstart-2"
              ><code>onstart</code></a
            >
            attribute is an
            <a
              data-link-type="idl"
              data-lt="EventHandler"
              data-type="typedef"
              href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"
              ><code>EventHandler</code></a
            >
            for a
            <a
              data-link-type="idl"
              data-lt="MonetizationStartEvent"
              href="#dom-monetizationstartevent"
              class="internalDFN"
              id="ref-for-dom-monetizationstartevent-3"
              ><code>MonetizationStartEvent</code></a
            >
            named "<a
              href="#dfn-start"
              class="internalDFN"
              data-link-type="dfn"
              id="ref-for-dfn-start-1"
              ><code>start</code></a
            >".
          </dd>
          <dt>
            <dfn
              data-export=""
              data-dfn-type="attribute"
              id="dom-monetization-onprogress"
              data-idl="attribute"
              data-title="onprogress"
              data-dfn-for="Monetization"
              data-type="EventHandler"
              data-lt="onprogress"
              data-local-lt="Monetization.onprogress"
              tabindex="0"
              aria-haspopup="dialog"
              ><code>onprogress</code></dfn
            >
            attribute
          </dt>
          <dd>
            A
            <a
              data-link-type="idl"
              href="#dom-monetization-onprogress"
              class="internalDFN"
              id="ref-for-dom-monetization-onprogress-2"
              ><code>onprogress</code></a
            >
            attribute is an
            <a
              data-link-type="idl"
              data-lt="EventHandler"
              data-type="typedef"
              href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"
              ><code>EventHandler</code></a
            >
            for an
            <a
              data-link-type="idl"
              data-lt="MonetizationProgressEvent"
              href="#dom-monetizationprogressevent"
              class="internalDFN"
              id="ref-for-dom-monetizationprogressevent-3"
              ><code>MonetizationProgressEvent</code></a
            >
            named "<a
              href="#dfn-progress"
              class="internalDFN"
              data-link-type="dfn"
              id="ref-for-dfn-progress-2"
              ><code>progress</code></a
            >".
          </dd>
        </dl>
      </section>
      <section data-dfn-for="MonetizationState" id="monetizationstate-enum">
        <div class="header-wrapper">
          <h3 id="x6-3-monetizationstate-enum">
            <bdi class="secno">6.3 </bdi
            ><dfn
              data-export=""
              data-dfn-type="enum"
              id="dom-monetizationstate"
              data-idl="enum"
              data-title="MonetizationState"
              data-dfn-for=""
              tabindex="0"
              aria-haspopup="dialog"
              ><code>MonetizationState</code></dfn
            >
            enum
          </h3>
          <a
            class="self-link"
            href="#monetizationstate-enum"
            aria-label="Permalink for Section 6.3"
          ></a>
        </div>

        <pre
          class="idl def"
          id="webidl-234340800"
        ><span class="idlHeader"><a class="self-link" href="#webidl-234340800">WebIDL</a></span><code><span data-idl="" class="idlEnum" id="idl-def-monetizationstate" data-title="MonetizationState">enum <a class="internalDFN idlID" data-link-type="enum" href="#dom-monetizationstate" id="ref-for-dom-monetizationstate-3"><code>MonetizationState</code></a> {
  <span class="idlEnumItem">"<a class="internalDFN" data-link-type="enum-value" href="#dom-monetizationstate-pending" id="ref-for-dom-monetizationstate-pending-2"><code>pending</code></a>"</span>,
  <span class="idlEnumItem">"<a class="internalDFN" data-link-type="enum-value" href="#dom-monetizationstate-started" id="ref-for-dom-monetizationstate-started-1"><code>started</code></a>"</span>
};</span></code></pre>
        <dl>
          <dt>
            "<dfn
              data-export=""
              data-dfn-type="enum-value"
              id="dom-monetizationstate-pending"
              data-idl="enum-value"
              data-title="pending"
              data-dfn-for="MonetizationState"
              tabindex="0"
              aria-haspopup="dialog"
              ><code>pending</code></dfn
            >"
          </dt>
          <dd>
            Indicates that monetization has not yet started. This is set even if
            there are no Web Monetization
            <code
              ><a
                data-link-type="element"
                data-type="element"
                href="https://html.spec.whatwg.org/multipage/semantics.html#meta"
                >meta</a
              ></code
            >
            elements in the document.
          </dd>
          <dt>
            "<dfn
              data-export=""
              data-dfn-type="enum-value"
              id="dom-monetizationstate-started"
              data-idl="enum-value"
              data-title="started"
              data-dfn-for="MonetizationState"
              tabindex="0"
              aria-haspopup="dialog"
              ><code>started</code></dfn
            >"
          </dt>
          <dd>
            Indicates that monetization has started (i.e. the user agent fired
            the <code>"start"</code> event).
          </dd>
        </dl>
      </section>
      <section id="events">
        <div class="header-wrapper">
          <h3 id="x6-4-events"><bdi class="secno">6.4 </bdi>Events</h3>
          <a
            class="self-link"
            href="#events"
            aria-label="Permalink for Section 6.4"
          ></a>
        </div>

        <section class="informative" id="summary">
          <div class="header-wrapper">
            <h4 id="x6-4-1-summary">
              <bdi class="secno">6.4.1 </bdi>
              Summary
            </h4>
            <a
              class="self-link"
              href="#summary"
              aria-label="Permalink for Section 6.4.1"
            ></a>
          </div>
          <p><em>This section is non-normative.</em></p>

          <div class="overlarge">
            <table class="def data">
              <tbody>
                <tr>
                  <th>Event name</th>
                  <th>Interface</th>
                  <th>Dispatched whenâ€¦</th>
                  <th>Target</th>
                </tr>
                <tr>
                  <td>
                    <code
                      ><dfn
                        id="dfn-start"
                        tabindex="0"
                        aria-haspopup="dialog"
                        data-dfn-type="dfn"
                        >start</dfn
                      ></code
                    >
                  </td>
                  <td>
                    <a
                      data-link-type="idl"
                      data-lt="MonetizationStartEvent"
                      href="#dom-monetizationstartevent"
                      class="internalDFN"
                      id="ref-for-dom-monetizationstartevent-4"
                      ><code>MonetizationStartEvent</code></a
                    >
                  </td>
                  <td>The first non-zero payment is successfully sent.</td>
                  <td>
                    <a
                      data-link-type="idl"
                      href="#dom-document-monetization"
                      class="internalDFN"
                      id="ref-for-dom-document-monetization-1"
                      ><code>monetization</code></a
                    >
                    attribute
                  </td>
                </tr>
                <tr>
                  <td>
                    <code
                      ><dfn
                        id="dfn-progress"
                        tabindex="0"
                        aria-haspopup="dialog"
                        data-dfn-type="dfn"
                        >progress</dfn
                      ></code
                    >
                  </td>
                  <td>
                    <a
                      data-link-type="idl"
                      data-lt="MonetizationProgressEvent"
                      href="#dom-monetizationprogressevent"
                      class="internalDFN"
                      id="ref-for-dom-monetizationprogressevent-4"
                      ><code>MonetizationProgressEvent</code></a
                    >
                  </td>
                  <td>A payment is successfully made to the receiver.</td>
                  <td>
                    <a
                      data-link-type="idl"
                      href="#dom-document-monetization"
                      class="internalDFN"
                      id="ref-for-dom-document-monetization-2"
                      ><code>monetization</code></a
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
        <section
          data-dfn-for="MonetizationStartEvent"
          id="monetizationstartevent-interface"
        >
          <div class="header-wrapper">
            <h4 id="x6-4-2-monetizationstartevent-interface">
              <bdi class="secno">6.4.2 </bdi
              ><dfn
                data-export=""
                data-dfn-type="interface"
                id="dom-monetizationstartevent"
                data-idl="interface"
                data-title="MonetizationStartEvent"
                data-dfn-for=""
                tabindex="0"
                aria-haspopup="dialog"
                ><code>MonetizationStartEvent</code></dfn
              >
              interface
            </h4>
            <a
              class="self-link"
              href="#monetizationstartevent-interface"
              aria-label="Permalink for Section 6.4.2"
            ></a>
          </div>

          <pre
            class="idl def"
            id="webidl-935235523"
          ><span class="idlHeader"><a class="self-link" href="#webidl-935235523">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-monetizationstartevent" data-title="MonetizationStartEvent">[<span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>]
interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-monetizationstartevent" id="ref-for-dom-monetizationstartevent-5"><code>MonetizationStartEvent</code></a> : <span class="idlSuperclass"><a data-link-type="idl" data-type="interface" href="https://dom.spec.whatwg.org/#event">Event</a></span> {<span data-idl="" class="idlConstructor" id="idl-def-monetizationstartevent-constructor-type-eventinitdict" data-title="constructor" data-dfn-for="MonetizationStartEvent">
  <a class="internalDFN" data-link-type="constructor" href="#dom-monetizationstartevent-constructor" id="ref-for-dom-monetizationstartevent-constructor-1"><code>constructor</code></a>(<span class="idlType"><a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">type</span>,<span class="idlType"> <a data-link-type="idl" href="#dom-monetizationstarteventinit" class="internalDFN" id="ref-for-dom-monetizationstarteventinit-1"><code>MonetizationStartEventInit</code></a></span> <span class="idlParamName">eventInitDict</span>);</span><span data-idl="" class="idlAttribute" id="idl-def-monetizationstartevent-paymentpointer" data-title="paymentPointer" data-dfn-for="MonetizationStartEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetizationstartevent-paymentpointer" id="ref-for-dom-monetizationstartevent-paymentpointer-1"><code>paymentPointer</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-monetizationstartevent-requestid" data-title="requestId" data-dfn-for="MonetizationStartEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetizationstartevent-requestid" id="ref-for-dom-monetizationstartevent-requestid-1"><code>requestId</code></a>;</span>
};</span></code></pre>
          <section id="constructor">
            <div class="header-wrapper">
              <h5 id="x6-4-2-1-constructor">
                <bdi class="secno">6.4.2.1 </bdi><code>constructor()</code>
              </h5>
              <a
                class="self-link"
                href="#constructor"
                aria-label="Permalink for Section 6.4.2.1"
              ></a>
            </div>

            <p>
              The
              <dfn
                data-export=""
                data-dfn-type="constructor"
                id="dom-monetizationstartevent-constructor"
                data-idl="constructor"
                data-title="constructor()"
                data-dfn-for="MonetizationStartEvent"
                data-lt="constructor()|constructor(type, eventInitDict)"
                data-local-lt="MonetizationStartEvent.constructor|MonetizationStartEvent.constructor()|constructor"
                tabindex="0"
                aria-haspopup="dialog"
                ><code>constructor()</code></dfn
              >
              for
              <a
                data-link-type="idl"
                data-lt="MonetizationStartEvent"
                href="#dom-monetizationstartevent"
                class="internalDFN"
                id="ref-for-dom-monetizationstartevent-6"
                ><code>MonetizationStartEvent</code></a
              >
              behaves as follows:
            </p>
            <ol class="algorithm">
              <li>...TBW...</li>
            </ol>
          </section>
          <section id="paymentpointer-attribute">
            <div class="header-wrapper">
              <h5 id="x6-4-2-2-paymentpointer-attribute">
                <bdi class="secno">6.4.2.2 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="attribute"
                  id="dom-monetizationstartevent-paymentpointer"
                  data-idl="attribute"
                  data-title="paymentPointer"
                  data-dfn-for="MonetizationStartEvent"
                  data-type="DOMString"
                  data-lt="paymentPointer"
                  data-local-lt="MonetizationStartEvent.paymentPointer"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>paymentPointer</code></dfn
                >
                attribute
              </h5>
              <a
                class="self-link"
                href="#paymentpointer-attribute"
                aria-label="Permalink for Section 6.4.2.2"
              ></a>
            </div>

            <p>
              When getting, returns the value it was initialized with. See
              <a
                data-link-type="idl"
                href="#dom-monetizationstarteventinit-paymentpointer"
                class="internalDFN"
                id="ref-for-dom-monetizationstarteventinit-paymentpointer-1"
                ><code>paymentPointer</code></a
              >
              member of
              <a
                data-link-type="idl"
                data-lt="MonetizationStartEventInit"
                href="#dom-monetizationstarteventinit"
                class="internalDFN"
                id="ref-for-dom-monetizationstarteventinit-2"
                ><code>MonetizationStartEventInit</code></a
              >
              for more information.
            </p>
          </section>
          <section id="requestid-attribute">
            <div class="header-wrapper">
              <h5 id="x6-4-2-3-requestid-attribute">
                <bdi class="secno">6.4.2.3 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="attribute"
                  id="dom-monetizationstartevent-requestid"
                  data-idl="attribute"
                  data-title="requestId"
                  data-dfn-for="MonetizationStartEvent"
                  data-type="DOMString"
                  data-lt="requestId"
                  data-local-lt="MonetizationStartEvent.requestId"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>requestId</code></dfn
                >
                attribute
              </h5>
              <a
                class="self-link"
                href="#requestid-attribute"
                aria-label="Permalink for Section 6.4.2.3"
              ></a>
            </div>

            <p>
              When getting, returns the value it was initialized with. See
              <a
                data-link-type="idl"
                href="#dom-monetizationstarteventinit-requestid"
                class="internalDFN"
                id="ref-for-dom-monetizationstarteventinit-requestid-1"
                ><code>requestId</code></a
              >
              member of
              <a
                data-link-type="idl"
                data-lt="MonetizationStartEventInit"
                href="#dom-monetizationstarteventinit"
                class="internalDFN"
                id="ref-for-dom-monetizationstarteventinit-3"
                ><code>MonetizationStartEventInit</code></a
              >
              for more information.
            </p>
          </section>
          <section
            data-dfn-for="MonetizationStartEventInit"
            id="monetizationstarteventinit-dictionary"
          >
            <div class="header-wrapper">
              <h5 id="x6-4-2-4-monetizationstarteventinit-dictionary">
                <bdi class="secno">6.4.2.4 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="dictionary"
                  id="dom-monetizationstarteventinit"
                  data-idl="dictionary"
                  data-title="MonetizationStartEventInit"
                  data-dfn-for=""
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>MonetizationStartEventInit</code></dfn
                >
                dictionary
              </h5>
              <a
                class="self-link"
                href="#monetizationstarteventinit-dictionary"
                aria-label="Permalink for Section 6.4.2.4"
              ></a>
            </div>

            <p>
              Dispatched once the first
              <abbr title="Interledger Protocol">ILP</abbr> packet with a
              non-zero amount has been fulfilled by the page's
              <abbr title="Simple Payment Setup Protocol">SPSP</abbr> receiver.
              <em class="rfc2119">MUST</em> be dispatched at least once if
              payment occurs.
            </p>
            <pre
              class="idl def"
              id="webidl-204849475"
            ><span class="idlHeader"><a class="self-link" href="#webidl-204849475">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-monetizationstarteventinit" data-title="MonetizationStartEventInit">dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-monetizationstarteventinit" id="ref-for-dom-monetizationstarteventinit-4"><code>MonetizationStartEventInit</code></a> : <span class="idlSuperclass"><a data-link-type="idl" data-type="dictionary" href="https://dom.spec.whatwg.org/#dictdef-eventinit">EventInit</a></span> {<span data-idl="" class="idlMember" id="idl-def-monetizationstarteventinit-paymentpointer" data-title="paymentPointer" data-dfn-for="MonetizationStartEventInit">
  required<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-monetizationstarteventinit-paymentpointer" id="ref-for-dom-monetizationstarteventinit-paymentpointer-2"><code>paymentPointer</code></a>;</span><span data-idl="" class="idlMember" id="idl-def-monetizationstarteventinit-requestid" data-title="requestId" data-dfn-for="MonetizationStartEventInit">
  required<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-monetizationstarteventinit-requestid" id="ref-for-dom-monetizationstarteventinit-requestid-2"><code>requestId</code></a>;</span>
};</span></code></pre>
            <dl>
              <dt>
                <dfn
                  data-export=""
                  data-dfn-type="dict-member"
                  id="dom-monetizationstarteventinit-paymentpointer"
                  data-idl="field"
                  data-title="paymentPointer"
                  data-dfn-for="MonetizationStartEventInit"
                  data-type="DOMString"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>paymentPointer</code></dfn
                >
                member
              </dt>
              <dd>
                A string representing the Payment Pointer resolved from the
                <code>&lt;meta name="monetization"&gt;</code> tag.
              </dd>
              <dt>
                <dfn
                  data-export=""
                  data-dfn-type="dict-member"
                  id="dom-monetizationstarteventinit-requestid"
                  data-idl="field"
                  data-title="requestId"
                  data-dfn-for="MonetizationStartEventInit"
                  data-type="DOMString"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>requestId</code></dfn
                >
                member
              </dt>
              <dd>
                The Monetization ID (UUID V4) generated by the browser (see
                <a href="#flow" data-matched-text="[[[#flow]]]" class="sec-ref"
                  ><bdi class="secno">5. </bdi>Flow</a
                >).
              </dd>
            </dl>
          </section>
        </section>
        <section
          data-dfn-for="MonetizationProgressEvent"
          id="monetizationprogressevent-interface"
        >
          <div class="header-wrapper">
            <h4 id="x6-4-3-monetizationprogressevent-interface">
              <bdi class="secno">6.4.3 </bdi
              ><dfn
                data-export=""
                data-dfn-type="interface"
                id="dom-monetizationprogressevent"
                data-idl="interface"
                data-title="MonetizationProgressEvent"
                data-dfn-for=""
                tabindex="0"
                aria-haspopup="dialog"
                ><code>MonetizationProgressEvent</code></dfn
              >
              interface
            </h4>
            <a
              class="self-link"
              href="#monetizationprogressevent-interface"
              aria-label="Permalink for Section 6.4.3"
            ></a>
          </div>

          <p>
            Dispatched every time an
            <abbr title="Interledger Protocol">ILP</abbr> packet with a non-zero
            amount has been fulfilled by the page's Web Monetization receiver
            (including the first time, when <code>start</code> event is also
            dispatched).
          </p>
          <pre
            class="idl def"
            id="webidl-279925406"
          ><span class="idlHeader"><a class="self-link" href="#webidl-279925406">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-monetizationprogressevent" data-title="MonetizationProgressEvent">[<span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>]
interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-monetizationprogressevent" id="ref-for-dom-monetizationprogressevent-5"><code>MonetizationProgressEvent</code></a> : <span class="idlSuperclass"><a data-link-type="idl" data-type="interface" href="https://dom.spec.whatwg.org/#event">Event</a></span> {<span data-idl="" class="idlConstructor" id="idl-def-monetizationprogressevent-constructor-type-eventinitdict" data-title="constructor" data-dfn-for="MonetizationProgressEvent">
  <a class="internalDFN" data-link-type="constructor" href="#dom-monetizationprogressevent-constructor" id="ref-for-dom-monetizationprogressevent-constructor-1"><code>constructor</code></a>(<span class="idlType"><a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">type</span>,<span class="idlType"> <a data-link-type="idl" href="#dom-monetizationprogresseventinit" class="internalDFN" id="ref-for-dom-monetizationprogresseventinit-1"><code>MonetizationProgressEventInit</code></a></span> <span class="idlParamName">eventInitDict</span>);</span><span data-idl="" class="idlAttribute" id="idl-def-monetizationprogressevent-amount" data-title="amount" data-dfn-for="MonetizationProgressEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetizationprogressevent-amount" id="ref-for-dom-monetizationprogressevent-amount-1"><code>amount</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-monetizationprogressevent-assetcode" data-title="assetCode" data-dfn-for="MonetizationProgressEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetizationprogressevent-assetcode" id="ref-for-dom-monetizationprogressevent-assetcode-1"><code>assetCode</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-monetizationprogressevent-assetscale" data-title="assetScale" data-dfn-for="MonetizationProgressEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetizationprogressevent-assetscale" id="ref-for-dom-monetizationprogressevent-assetscale-1"><code>assetScale</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-monetizationprogressevent-receipt" data-title="receipt" data-dfn-for="MonetizationProgressEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a>?</span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-monetizationprogressevent-receipt" id="ref-for-dom-monetizationprogressevent-receipt-1"><code>receipt</code></a>;</span>
};</span></code></pre>
          <section id="constructor-0">
            <div class="header-wrapper">
              <h5 id="x6-4-3-1-constructor">
                <bdi class="secno">6.4.3.1 </bdi><code>constructor()</code>
              </h5>
              <a
                class="self-link"
                href="#constructor-0"
                aria-label="Permalink for Section 6.4.3.1"
              ></a>
            </div>

            <p>
              The
              <dfn
                data-export=""
                data-dfn-type="constructor"
                id="dom-monetizationprogressevent-constructor"
                data-idl="constructor"
                data-title="constructor()"
                data-dfn-for="MonetizationProgressEvent"
                data-lt="constructor()|constructor(type, eventInitDict)"
                data-local-lt="MonetizationProgressEvent.constructor|MonetizationProgressEvent.constructor()|constructor"
                tabindex="0"
                aria-haspopup="dialog"
                ><code>constructor()</code></dfn
              >
              for
              <a
                data-link-type="idl"
                data-lt="MonetizationProgressEvent"
                href="#dom-monetizationprogressevent"
                class="internalDFN"
                id="ref-for-dom-monetizationprogressevent-6"
                ><code>MonetizationProgressEvent</code></a
              >
              behaves as follows:
            </p>
            <ol class="algorithm">
              <li>...TBW...</li>
            </ol>
          </section>
          <section id="amount-attribute">
            <div class="header-wrapper">
              <h5 id="x6-4-3-2-amount-attribute">
                <bdi class="secno">6.4.3.2 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="attribute"
                  id="dom-monetizationprogressevent-amount"
                  data-idl="attribute"
                  data-title="amount"
                  data-dfn-for="MonetizationProgressEvent"
                  data-type="DOMString"
                  data-lt="amount"
                  data-local-lt="MonetizationProgressEvent.amount"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>amount</code></dfn
                >
                attribute
              </h5>
              <a
                class="self-link"
                href="#amount-attribute"
                aria-label="Permalink for Section 6.4.3.2"
              ></a>
            </div>

            <p>
              When getting, returns the value it was initialized with. See
              <a
                data-link-type="idl"
                href="#dom-monetizationprogresseventinit-amount"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-amount-1"
                ><code>amount</code></a
              >
              member of
              <a
                data-link-type="idl"
                data-lt="MonetizationProgressEventInit"
                href="#dom-monetizationprogresseventinit"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-2"
                ><code>MonetizationProgressEventInit</code></a
              >
              for more information.
            </p>
          </section>
          <section id="assetcode-attribute">
            <div class="header-wrapper">
              <h5 id="x6-4-3-3-assetcode-attribute">
                <bdi class="secno">6.4.3.3 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="attribute"
                  id="dom-monetizationprogressevent-assetcode"
                  data-idl="attribute"
                  data-title="assetCode"
                  data-dfn-for="MonetizationProgressEvent"
                  data-type="DOMString"
                  data-lt="assetCode"
                  data-local-lt="MonetizationProgressEvent.assetCode"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>assetCode</code></dfn
                >
                attribute
              </h5>
              <a
                class="self-link"
                href="#assetcode-attribute"
                aria-label="Permalink for Section 6.4.3.3"
              ></a>
            </div>

            <p>
              When getting, returns the value it was initialized with. See
              <a
                data-link-type="idl"
                href="#dom-monetizationprogresseventinit-assetcode"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-assetcode-1"
                ><code>assetCode</code></a
              >
              member of
              <a
                data-link-type="idl"
                data-lt="MonetizationProgressEventInit"
                href="#dom-monetizationprogresseventinit"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-3"
                ><code>MonetizationProgressEventInit</code></a
              >
              for more information.
            </p>
          </section>
          <section id="assetscale-attribute">
            <div class="header-wrapper">
              <h5 id="x6-4-3-4-assetscale-attribute">
                <bdi class="secno">6.4.3.4 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="attribute"
                  id="dom-monetizationprogressevent-assetscale"
                  data-idl="attribute"
                  data-title="assetScale"
                  data-dfn-for="MonetizationProgressEvent"
                  data-type="DOMString"
                  data-lt="assetScale"
                  data-local-lt="MonetizationProgressEvent.assetScale"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>assetScale</code></dfn
                >
                attribute
              </h5>
              <a
                class="self-link"
                href="#assetscale-attribute"
                aria-label="Permalink for Section 6.4.3.4"
              ></a>
            </div>

            <p>
              When getting, returns the value it was initialized with. See
              <a
                data-link-type="idl"
                href="#dom-monetizationprogresseventinit-assetscale"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-assetscale-1"
                ><code>assetScale</code></a
              >
              member of
              <a
                data-link-type="idl"
                data-lt="MonetizationProgressEventInit"
                href="#dom-monetizationprogresseventinit"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-4"
                ><code>MonetizationProgressEventInit</code></a
              >
              for more information.
            </p>
          </section>
          <section id="receipt-attribute">
            <div class="header-wrapper">
              <h5 id="x6-4-3-5-receipt-attribute">
                <bdi class="secno">6.4.3.5 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="attribute"
                  id="dom-monetizationprogressevent-receipt"
                  data-idl="attribute"
                  data-title="receipt"
                  data-dfn-for="MonetizationProgressEvent"
                  data-type="DOMString"
                  data-lt="receipt"
                  data-local-lt="MonetizationProgressEvent.receipt"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>receipt</code></dfn
                >
                attribute
              </h5>
              <a
                class="self-link"
                href="#receipt-attribute"
                aria-label="Permalink for Section 6.4.3.5"
              ></a>
            </div>

            <p>
              When getting, returns the value it was initialized with. See
              <a
                data-link-type="idl"
                href="#dom-monetizationprogresseventinit-receipt"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-receipt-1"
                ><code>receipt</code></a
              >
              member of
              <a
                data-link-type="idl"
                data-lt="MonetizationProgressEventInit"
                href="#dom-monetizationprogresseventinit"
                class="internalDFN"
                id="ref-for-dom-monetizationprogresseventinit-5"
                ><code>MonetizationProgressEventInit</code></a
              >
              for more information.
            </p>
          </section>
          <section
            data-dfn-for="MonetizationProgressEventInit"
            id="monetizationprogresseventinit-dictionary"
          >
            <div class="header-wrapper">
              <h5 id="x6-4-3-6-monetizationprogresseventinit-dictionary">
                <bdi class="secno">6.4.3.6 </bdi
                ><dfn
                  data-export=""
                  data-dfn-type="dictionary"
                  id="dom-monetizationprogresseventinit"
                  data-idl="dictionary"
                  data-title="MonetizationProgressEventInit"
                  data-dfn-for=""
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>MonetizationProgressEventInit</code></dfn
                >
                dictionary
              </h5>
              <a
                class="self-link"
                href="#monetizationprogresseventinit-dictionary"
                aria-label="Permalink for Section 6.4.3.6"
              ></a>
            </div>

            <pre
              class="idl def"
              id="webidl-532031753"
            ><span class="idlHeader"><a class="self-link" href="#webidl-532031753">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-monetizationprogresseventinit" data-title="MonetizationProgressEventInit">dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-monetizationprogresseventinit" id="ref-for-dom-monetizationprogresseventinit-6"><code>MonetizationProgressEventInit</code></a> : <span class="idlSuperclass"><a data-link-type="idl" data-type="dictionary" href="https://dom.spec.whatwg.org/#dictdef-eventinit">EventInit</a></span> {<span data-idl="" class="idlMember" id="idl-def-monetizationprogresseventinit-amount" data-title="amount" data-dfn-for="MonetizationProgressEventInit">
  required<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-monetizationprogresseventinit-amount" id="ref-for-dom-monetizationprogresseventinit-amount-2"><code>amount</code></a>;</span><span data-idl="" class="idlMember" id="idl-def-monetizationprogresseventinit-assetcode" data-title="assetCode" data-dfn-for="MonetizationProgressEventInit">
  required<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-monetizationprogresseventinit-assetcode" id="ref-for-dom-monetizationprogresseventinit-assetcode-2"><code>assetCode</code></a>;</span><span data-idl="" class="idlMember" id="idl-def-monetizationprogresseventinit-assetscale" data-title="assetScale" data-dfn-for="MonetizationProgressEventInit">
  required<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-monetizationprogresseventinit-assetscale" id="ref-for-dom-monetizationprogresseventinit-assetscale-2"><code>assetScale</code></a>;</span><span data-idl="" class="idlMember" id="idl-def-monetizationprogresseventinit-receipt" data-title="receipt" data-dfn-for="MonetizationProgressEventInit"><span class="idlType">
  <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-monetizationprogresseventinit-receipt" id="ref-for-dom-monetizationprogresseventinit-receipt-2"><code>receipt</code></a>;</span>
};</span></code></pre>
            <dl>
              <dt>
                <dfn
                  data-export=""
                  data-dfn-type="dict-member"
                  id="dom-monetizationprogresseventinit-amount"
                  data-idl="field"
                  data-title="amount"
                  data-dfn-for="MonetizationProgressEventInit"
                  data-type="DOMString"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>amount</code></dfn
                >
                member
              </dt>
              <dd>
                The destination amount <em>received</em> as specified in the
                <abbr title="Interledger Protocol">ILP</abbr>
                packet.
              </dd>
              <dt>
                <dfn
                  data-export=""
                  data-dfn-type="dict-member"
                  id="dom-monetizationprogresseventinit-assetcode"
                  data-idl="field"
                  data-title="assetCode"
                  data-dfn-for="MonetizationProgressEventInit"
                  data-type="DOMString"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>assetCode</code></dfn
                >
                member
              </dt>
              <dd>
                The three letter asset code describing the amount's units.
              </dd>
              <dt>
                <dfn
                  data-export=""
                  data-dfn-type="dict-member"
                  id="dom-monetizationprogresseventinit-assetscale"
                  data-idl="field"
                  data-title="assetScale"
                  data-dfn-for="MonetizationProgressEventInit"
                  data-type="DOMString"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>assetScale</code></dfn
                >
                member
              </dt>
              <dd>
                The scale of the amount. For example, USD would have an
                <code>assetScale</code> of <code>2</code> when denominated in
                cents.
              </dd>
              <dt>
                <dfn
                  data-export=""
                  data-dfn-type="dict-member"
                  id="dom-monetizationprogresseventinit-receipt"
                  data-idl="field"
                  data-title="receipt"
                  data-dfn-for="MonetizationProgressEventInit"
                  data-type="DOMString"
                  tabindex="0"
                  aria-haspopup="dialog"
                  ><code>receipt</code></dfn
                >
                member
              </dt>
              <dd>
                base64-encoded
                <cite
                  ><a
                    data-matched-text="[[[Receipt]]]"
                    href="https://interledger.org/rfcs/0039-stream-receipts/"
                    >STREAM Receipt</a
                  ></cite
                >
                issued by the Web Monetization receiver to the Web Monetization
                provider as proof of the total amount received in the stream.
              </dd>
            </dl>
          </section>
        </section>
      </section>
      <section id="http-headers">
        <div class="header-wrapper">
          <h3 id="x6-5-http-headers">
            <bdi class="secno">6.5 </bdi>HTTP Headers
          </h3>
          <a
            class="self-link"
            href="#http-headers"
            aria-label="Permalink for Section 6.5"
          ></a>
        </div>

        <section id="web-monetization-id">
          <div class="header-wrapper">
            <h4 id="x6-5-1-web-monetization-id">
              <bdi class="secno">6.5.1 </bdi><code>Web-Monetization-Id</code>
            </h4>
            <a
              class="self-link"
              href="#web-monetization-id"
              aria-label="Permalink for Section 6.5.1"
            ></a>
          </div>
          <div class="warning" id="issue-container-generatedID-0">
            <div
              role="heading"
              class="warning-title marker"
              id="h-warning-0"
              aria-level="4"
            >
              <span>Warning</span>
            </div>
            <p class="">
              DEPRECATED: The <code>Web-Monetization-Id</code> header is
              deprecated in favor of receipts.
            </p>
          </div>
          <p>
            Contains the <code>Monetization ID</code> (currently referred to as
            <a
              data-link-type="idl"
              href="#dom-monetizationstartevent-requestid"
              class="internalDFN"
              id="ref-for-dom-monetizationstartevent-requestid-2"
              ><code>requestId</code></a
            >
            in the
            <a
              data-link-type="idl"
              data-lt="MonetizationStartEvent"
              href="#dom-monetizationstartevent"
              class="internalDFN"
              id="ref-for-dom-monetizationstartevent-7"
              ><code>MonetizationStartEvent</code></a
            >) as a a UUID version 4, which the user agent generated. This
            header <em class="rfc2119">MAY</em> be sent on [<cite
              ><a
                class="bibref"
                data-link-type="biblio"
                href="#bib-spsp"
                title="Simple Payments Setup Protocol"
                >SPSP</a
              ></cite
            >] queries for Web Monetization.
          </p>
          <div class="example" id="example-2">
            <div class="marker">
              <a class="self-link" href="#example-2">Example<bdi> 2</bdi></a>
            </div>
            <pre
              class="http"
              aria-busy="false"
            ><code class="hljs">Web-Monetization-Id: dcd479ad-7d8d-4210-956a-13c14b8c67eb</code></pre>
          </div>
        </section>
      </section>
    </section>
    <section id="conformance" class="appendix">
      <div class="header-wrapper">
        <h2 id="a-conformance"><bdi class="secno">A. </bdi>Conformance</h2>
        <a
          class="self-link"
          href="#conformance"
          aria-label="Permalink for Appendix A."
        ></a>
      </div>
      <p>
        As well as sections marked as non-normative, all authoring guidelines,
        diagrams, examples, and notes in this specification are non-normative.
        Everything else in this specification is normative.
      </p>
      <p>
        The key words <em class="rfc2119">MAY</em>,
        <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, and
        <em class="rfc2119">SHOULD</em> in this document are to be interpreted
        as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite
          ><a
            class="bibref"
            data-link-type="biblio"
            href="#bib-rfc2119"
            title="Key words for use in RFCs to Indicate Requirement Levels"
            >RFC2119</a
          ></cite
        >] [<cite
          ><a
            class="bibref"
            data-link-type="biblio"
            href="#bib-rfc8174"
            title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"
            >RFC8174</a
          ></cite
        >] when, and only when, they appear in all capitals, as shown here.
      </p>
    </section>

    <section id="references" class="appendix">
      <div class="header-wrapper">
        <h2 id="b-references"><bdi class="secno">B. </bdi>References</h2>
        <a
          class="self-link"
          href="#references"
          aria-label="Permalink for Appendix B."
        ></a>
      </div>
      <section id="normative-references">
        <div class="header-wrapper">
          <h3 id="b-1-normative-references">
            <bdi class="secno">B.1 </bdi>Normative references
          </h3>
          <a
            class="self-link"
            href="#normative-references"
            aria-label="Permalink for Appendix B.1"
          ></a>
        </div>

        <dl class="bibliography">
          <dt id="bib-dom">[dom]</dt>
          <dd>
            <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a
            >. Anne van Kesteren. WHATWG. Living Standard. URL:
            <a href="https://dom.spec.whatwg.org/"
              >https://dom.spec.whatwg.org/</a
            >
          </dd>
          <dt id="bib-html">[html]</dt>
          <dd>
            <a href="https://html.spec.whatwg.org/multipage/"
              ><cite>HTML Standard</cite></a
            >. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip
            JÃ¤genstedt; Simon Pieters. WHATWG. Living Standard. URL:
            <a href="https://html.spec.whatwg.org/multipage/"
              >https://html.spec.whatwg.org/multipage/</a
            >
          </dd>
          <dt id="bib-receipt">[Receipt]</dt>
          <dd>
            <a href="https://interledger.org/rfcs/0039-stream-receipts/"
              ><cite>STREAM Receipt</cite></a
            >. URL:
            <a href="https://interledger.org/rfcs/0039-stream-receipts/"
              >https://interledger.org/rfcs/0039-stream-receipts/</a
            >
          </dd>
          <dt id="bib-rfc2119">[RFC2119]</dt>
          <dd>
            <a href="https://www.rfc-editor.org/rfc/rfc2119"
              ><cite
                >Key words for use in RFCs to Indicate Requirement Levels</cite
              ></a
            >. S. Bradner. IETF. March 1997. Best Current Practice. URL:
            <a href="https://www.rfc-editor.org/rfc/rfc2119"
              >https://www.rfc-editor.org/rfc/rfc2119</a
            >
          </dd>
          <dt id="bib-rfc8174">[RFC8174]</dt>
          <dd>
            <a href="https://www.rfc-editor.org/rfc/rfc8174"
              ><cite
                >Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite
              ></a
            >. B. Leiba. IETF. May 2017. Best Current Practice. URL:
            <a href="https://www.rfc-editor.org/rfc/rfc8174"
              >https://www.rfc-editor.org/rfc/rfc8174</a
            >
          </dd>
          <dt id="bib-spsp">[SPSP]</dt>
          <dd>
            <a
              href="https://interledger.org/rfcs/0009-simple-payment-setup-protocol"
              ><cite>Simple Payments Setup Protocol</cite></a
            >. URL:
            <a
              href="https://interledger.org/rfcs/0009-simple-payment-setup-protocol"
              >https://interledger.org/rfcs/0009-simple-payment-setup-protocol</a
            >
          </dd>
          <dt id="bib-stream">[STREAM]</dt>
          <dd>
            <a href="https://interledger.org/rfcs/0029-stream/"
              ><cite>STREAM</cite></a
            >. URL:
            <a href="https://interledger.org/rfcs/0029-stream/"
              >https://interledger.org/rfcs/0029-stream/</a
            >
          </dd>
          <dt id="bib-webidl">[webidl]</dt>
          <dd>
            <a href="https://webidl.spec.whatwg.org/"
              ><cite>Web IDL Standard</cite></a
            >. Edgar Chen; Timothy Gu. WHATWG. Living Standard. URL:
            <a href="https://webidl.spec.whatwg.org/"
              >https://webidl.spec.whatwg.org/</a
            >
          </dd>
        </dl>
      </section>
      <section id="informative-references">
        <div class="header-wrapper">
          <h3 id="b-2-informative-references">
            <bdi class="secno">B.2 </bdi>Informative references
          </h3>
          <a
            class="self-link"
            href="#informative-references"
            aria-label="Permalink for Appendix B.2"
          ></a>
        </div>

        <dl class="bibliography">
          <dt id="bib-interledger">[Interledger]</dt>
          <dd>
            <a href="https://interledger.org/rfcs/0027-interledger-protocol-4/"
              ><cite>Interledger Protocol (ILP)</cite></a
            >. URL:
            <a href="https://interledger.org/rfcs/0027-interledger-protocol-4/"
              >https://interledger.org/rfcs/0027-interledger-protocol-4/</a
            >
          </dd>
          <dt id="bib-payment-handler">[Payment-Handler]</dt>
          <dd>
            <a href="https://www.w3.org/TR/payment-handler/"
              ><cite>Payment Handler API</cite></a
            >. Adrian Hope-Bailie; Ian Jacobs; Rouslan Solomakhin; Jinho Bang.
            W3C. 25 January 2023. W3C Working Draft. URL:
            <a href="https://www.w3.org/TR/payment-handler/"
              >https://www.w3.org/TR/payment-handler/</a
            >
          </dd>
          <dt id="bib-payment-request">[payment-Request]</dt>
          <dd>
            <a href="https://www.w3.org/TR/payment-request/"
              ><cite>Payment Request API</cite></a
            >. Marcos Caceres; Rouslan Solomakhin; Ian Jacobs. W3C. 8 September
            2022. W3C Recommendation. URL:
            <a href="https://www.w3.org/TR/payment-request/"
              >https://www.w3.org/TR/payment-request/</a
            >
          </dd>
        </dl>
      </section>
    </section>
    <p role="navigation" id="back-to-top">
      <a href="#title"><abbr title="Back to Top">â†‘</abbr></a>
    </p>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dfn-user"
      aria-label="Links in this document to definition: User"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dfn-user"
          aria-label="Permalink for definition: User. Activate to close this dialog."
          >Permalink</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>Not referenced in this document.</li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dfn-website"
      aria-label="Links in this document to definition: Website"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dfn-website"
          aria-label="Permalink for definition: Website. Activate to close this dialog."
          >Permalink</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>Not referenced in this document.</li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dfn-provider"
      aria-label="Links in this document to definition: Web Monetization provider"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dfn-provider"
          aria-label="Permalink for definition: Web Monetization provider. Activate to close this dialog."
          >Permalink</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dfn-provider-1" title="Â§ 5. Flow">Â§ 5. Flow</a>
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dfn-web-monetization-receiver"
      aria-label="Links in this document to definition: Web Monetization receiver"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dfn-web-monetization-receiver"
          aria-label="Permalink for definition: Web Monetization receiver. Activate to close this dialog."
          >Permalink</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>Not referenced in this document.</li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dfn-user-agent"
      aria-label="Links in this document to definition: User agent"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dfn-user-agent"
          aria-label="Permalink for definition: User agent. Activate to close this dialog."
          >Permalink</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dfn-user-agent-1" title="Â§ 5. Flow">Â§ 5. Flow</a>
          <a href="#ref-for-dfn-user-agent-2" title="Reference 2">(2)</a>
          <a href="#ref-for-dfn-user-agent-3" title="Reference 3">(3)</a>
          <a href="#ref-for-dfn-user-agent-4" title="Reference 4">(4)</a>
          <a href="#ref-for-dfn-user-agent-5" title="Reference 5">(5)</a>
          <a href="#ref-for-dfn-user-agent-6" title="Reference 6">(6)</a>
          <a href="#ref-for-dfn-user-agent-7" title="Reference 7">(7)</a>
          <a href="#ref-for-dfn-user-agent-8" title="Reference 8">(8)</a>
          <a href="#ref-for-dfn-user-agent-9" title="Reference 9">(9)</a>
        </li>
        <li>
          <a
            href="#ref-for-dfn-user-agent-10"
            title="Â§ 5.1 Payment Handler Flow"
            >Â§ 5.1 Payment Handler Flow</a
          >
        </li>
        <li>
          <a href="#ref-for-dfn-user-agent-11" title="Â§ 6.1 Meta Tags Set"
            >Â§ 6.1 Meta Tags Set</a
          >
          <a href="#ref-for-dfn-user-agent-12" title="Reference 2">(2)</a>
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-document-monetization"
      aria-label="Links in this document to definition: monetization"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-document-monetization"
          aria-label="Permalink for definition: monetization. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dom-document-monetization-1" title="Â§ 6.4.1 Summary"
            >Â§ 6.4.1 Summary</a
          >
          <a href="#ref-for-dom-document-monetization-2" title="Reference 2"
            >(2)</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetization"
      aria-label="Links in this document to definition: Monetization"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetization"
          aria-label="Permalink for definition: Monetization. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-1263749486"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetization-1"
            title="Â§ 4. Extensions to the Document interface"
            >Â§ 4. Extensions to the Document interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetization-2"
            title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetization-state"
      aria-label="Links in this document to definition: state"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetization-state"
          aria-label="Permalink for definition: state. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-1263749486"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dom-monetization-state-1" title="Â§ 5. Flow"
            >Â§ 5. Flow</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetization-state-2"
            title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
          <a href="#ref-for-dom-monetization-state-3" title="Reference 2"
            >(2)</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetization-onstart"
      aria-label="Links in this document to definition: onstart"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetization-onstart"
          aria-label="Permalink for definition: onstart. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-1263749486"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetization-onstart-1"
            title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
          <a href="#ref-for-dom-monetization-onstart-2" title="Reference 2"
            >(2)</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetization-onprogress"
      aria-label="Links in this document to definition: onprogress"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetization-onprogress"
          aria-label="Permalink for definition: onprogress. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-1263749486"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetization-onprogress-1"
            title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
          <a href="#ref-for-dom-monetization-onprogress-2" title="Reference 2"
            >(2)</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstate"
      aria-label="Links in this document to definition: MonetizationState"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstate"
          aria-label="Permalink for definition: MonetizationState. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-234340800"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstate-1"
            title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
          <a href="#ref-for-dom-monetizationstate-2" title="Reference 2">(2)</a>
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstate-3"
            title="Â§ 6.3 MonetizationState enum"
            >Â§ 6.3 MonetizationState enum</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstate-pending"
      aria-label="Links in this document to definition: pending"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstate-pending"
          aria-label="Permalink for definition: pending. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-234340800"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dom-monetizationstate-pending-1" title="Â§ 5. Flow"
            >Â§ 5. Flow</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstate-pending-2"
            title="Â§ 6.3 MonetizationState enum"
            >Â§ 6.3 MonetizationState enum</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstate-started"
      aria-label="Links in this document to definition: started"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstate-started"
          aria-label="Permalink for definition: started. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-234340800"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstate-started-1"
            title="Â§ 6.3 MonetizationState enum"
            >Â§ 6.3 MonetizationState enum</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dfn-start"
      aria-label="Links in this document to definition: start"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dfn-start"
          aria-label="Permalink for definition: start. Activate to close this dialog."
          >Permalink</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dfn-start-1" title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dfn-progress"
      aria-label="Links in this document to definition: progress"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dfn-progress"
          aria-label="Permalink for definition: progress. Activate to close this dialog."
          >Permalink</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dfn-progress-1" title="Â§ 5. Flow">Â§ 5. Flow</a>
        </li>
        <li>
          <a href="#ref-for-dfn-progress-2" title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstartevent"
      aria-label="Links in this document to definition: MonetizationStartEvent"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstartevent"
          aria-label="Permalink for definition: MonetizationStartEvent. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-935235523"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dom-monetizationstartevent-1" title="Â§ 5. Flow"
            >Â§ 5. Flow</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-2"
            title="Â§ 5.1 Payment Handler Flow"
            >Â§ 5.1 Payment Handler Flow</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-3"
            title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-4"
            title="Â§ 6.4.1 Summary"
            >Â§ 6.4.1 Summary</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-5"
            title="Â§ 6.4.2 MonetizationStartEvent interface"
            >Â§ 6.4.2 MonetizationStartEvent interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-6"
            title="Â§ 6.4.2.1 constructor()"
            >Â§ 6.4.2.1 constructor()</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-7"
            title="Â§ 6.5.1 Web-Monetization-Id"
            >Â§ 6.5.1 Web-Monetization-Id</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstartevent-constructor"
      aria-label="Links in this document to definition: constructor()"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstartevent-constructor"
          aria-label="Permalink for definition: constructor(). Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-935235523"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-constructor-1"
            title="Â§ 6.4.2 MonetizationStartEvent interface"
            >Â§ 6.4.2 MonetizationStartEvent interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstartevent-paymentpointer"
      aria-label="Links in this document to definition: paymentPointer"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstartevent-paymentpointer"
          aria-label="Permalink for definition: paymentPointer. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-935235523"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-paymentpointer-1"
            title="Â§ 6.4.2 MonetizationStartEvent interface"
            >Â§ 6.4.2 MonetizationStartEvent interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstartevent-requestid"
      aria-label="Links in this document to definition: requestId"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstartevent-requestid"
          aria-label="Permalink for definition: requestId. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-935235523"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-requestid-1"
            title="Â§ 6.4.2 MonetizationStartEvent interface"
            >Â§ 6.4.2 MonetizationStartEvent interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstartevent-requestid-2"
            title="Â§ 6.5.1 Web-Monetization-Id"
            >Â§ 6.5.1 Web-Monetization-Id</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstarteventinit"
      aria-label="Links in this document to definition: MonetizationStartEventInit"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstarteventinit"
          aria-label="Permalink for definition: MonetizationStartEventInit. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-204849475"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-1"
            title="Â§ 6.4.2 MonetizationStartEvent interface"
            >Â§ 6.4.2 MonetizationStartEvent interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-2"
            title="Â§ 6.4.2.2 paymentPointer attribute"
            >Â§ 6.4.2.2 paymentPointer attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-3"
            title="Â§ 6.4.2.3 requestId attribute"
            >Â§ 6.4.2.3 requestId attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-4"
            title="Â§ 6.4.2.4 MonetizationStartEventInit dictionary"
            >Â§ 6.4.2.4 MonetizationStartEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstarteventinit-paymentpointer"
      aria-label="Links in this document to definition: paymentPointer"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstarteventinit-paymentpointer"
          aria-label="Permalink for definition: paymentPointer. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-204849475"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-paymentpointer-1"
            title="Â§ 6.4.2.2 paymentPointer attribute"
            >Â§ 6.4.2.2 paymentPointer attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-paymentpointer-2"
            title="Â§ 6.4.2.4 MonetizationStartEventInit dictionary"
            >Â§ 6.4.2.4 MonetizationStartEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationstarteventinit-requestid"
      aria-label="Links in this document to definition: requestId"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationstarteventinit-requestid"
          aria-label="Permalink for definition: requestId. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-204849475"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-requestid-1"
            title="Â§ 6.4.2.3 requestId attribute"
            >Â§ 6.4.2.3 requestId attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationstarteventinit-requestid-2"
            title="Â§ 6.4.2.4 MonetizationStartEventInit dictionary"
            >Â§ 6.4.2.4 MonetizationStartEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogressevent"
      aria-label="Links in this document to definition: MonetizationProgressEvent"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogressevent"
          aria-label="Permalink for definition: MonetizationProgressEvent. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-279925406"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a href="#ref-for-dom-monetizationprogressevent-1" title="Â§ 5. Flow"
            >Â§ 5. Flow</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-2"
            title="Â§ 5.1 Payment Handler Flow"
            >Â§ 5.1 Payment Handler Flow</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-3"
            title="Â§ 6.2 Monetization interface"
            >Â§ 6.2 Monetization interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-4"
            title="Â§ 6.4.1 Summary"
            >Â§ 6.4.1 Summary</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-5"
            title="Â§ 6.4.3 MonetizationProgressEvent interface"
            >Â§ 6.4.3 MonetizationProgressEvent interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-6"
            title="Â§ 6.4.3.1 constructor()"
            >Â§ 6.4.3.1 constructor()</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogressevent-constructor"
      aria-label="Links in this document to definition: constructor()"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogressevent-constructor"
          aria-label="Permalink for definition: constructor(). Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-279925406"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-constructor-1"
            title="Â§ 6.4.3 MonetizationProgressEvent interface"
            >Â§ 6.4.3 MonetizationProgressEvent interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogressevent-amount"
      aria-label="Links in this document to definition: amount"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogressevent-amount"
          aria-label="Permalink for definition: amount. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-279925406"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-amount-1"
            title="Â§ 6.4.3 MonetizationProgressEvent interface"
            >Â§ 6.4.3 MonetizationProgressEvent interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogressevent-assetcode"
      aria-label="Links in this document to definition: assetCode"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogressevent-assetcode"
          aria-label="Permalink for definition: assetCode. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-279925406"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-assetcode-1"
            title="Â§ 6.4.3 MonetizationProgressEvent interface"
            >Â§ 6.4.3 MonetizationProgressEvent interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogressevent-assetscale"
      aria-label="Links in this document to definition: assetScale"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogressevent-assetscale"
          aria-label="Permalink for definition: assetScale. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-279925406"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-assetscale-1"
            title="Â§ 6.4.3 MonetizationProgressEvent interface"
            >Â§ 6.4.3 MonetizationProgressEvent interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogressevent-receipt"
      aria-label="Links in this document to definition: receipt"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogressevent-receipt"
          aria-label="Permalink for definition: receipt. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-279925406"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogressevent-receipt-1"
            title="Â§ 6.4.3 MonetizationProgressEvent interface"
            >Â§ 6.4.3 MonetizationProgressEvent interface</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogresseventinit"
      aria-label="Links in this document to definition: MonetizationProgressEventInit"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogresseventinit"
          aria-label="Permalink for definition: MonetizationProgressEventInit. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-532031753"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-1"
            title="Â§ 6.4.3 MonetizationProgressEvent interface"
            >Â§ 6.4.3 MonetizationProgressEvent interface</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-2"
            title="Â§ 6.4.3.2 amount attribute"
            >Â§ 6.4.3.2 amount attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-3"
            title="Â§ 6.4.3.3 assetCode attribute"
            >Â§ 6.4.3.3 assetCode attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-4"
            title="Â§ 6.4.3.4 assetScale attribute"
            >Â§ 6.4.3.4 assetScale attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-5"
            title="Â§ 6.4.3.5 receipt attribute"
            >Â§ 6.4.3.5 receipt attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-6"
            title="Â§ 6.4.3.6 MonetizationProgressEventInit dictionary"
            >Â§ 6.4.3.6 MonetizationProgressEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogresseventinit-amount"
      aria-label="Links in this document to definition: amount"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogresseventinit-amount"
          aria-label="Permalink for definition: amount. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-532031753"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-amount-1"
            title="Â§ 6.4.3.2 amount attribute"
            >Â§ 6.4.3.2 amount attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-amount-2"
            title="Â§ 6.4.3.6 MonetizationProgressEventInit dictionary"
            >Â§ 6.4.3.6 MonetizationProgressEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogresseventinit-assetcode"
      aria-label="Links in this document to definition: assetCode"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogresseventinit-assetcode"
          aria-label="Permalink for definition: assetCode. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-532031753"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-assetcode-1"
            title="Â§ 6.4.3.3 assetCode attribute"
            >Â§ 6.4.3.3 assetCode attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-assetcode-2"
            title="Â§ 6.4.3.6 MonetizationProgressEventInit dictionary"
            >Â§ 6.4.3.6 MonetizationProgressEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogresseventinit-assetscale"
      aria-label="Links in this document to definition: assetScale"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogresseventinit-assetscale"
          aria-label="Permalink for definition: assetScale. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-532031753"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-assetscale-1"
            title="Â§ 6.4.3.4 assetScale attribute"
            >Â§ 6.4.3.4 assetScale attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-assetscale-2"
            title="Â§ 6.4.3.6 MonetizationProgressEventInit dictionary"
            >Â§ 6.4.3.6 MonetizationProgressEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <div
      class="dfn-panel"
      hidden=""
      role="dialog"
      aria-modal="true"
      id="dfn-panel-for-dom-monetizationprogresseventinit-receipt"
      aria-label="Links in this document to definition: receipt"
    >
      <span class="caret"></span>
      <div>
        <a
          class="self-link"
          href="#dom-monetizationprogresseventinit-receipt"
          aria-label="Permalink for definition: receipt. Activate to close this dialog."
          >Permalink</a
        >
        <span
          class="marker dfn-exported"
          title="Definition can be referenced by other specifications"
          >exported</span
        >
        <a
          class="marker idl-block"
          title="Jump to IDL declaration"
          href="#webidl-532031753"
          >IDL</a
        >
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-receipt-1"
            title="Â§ 6.4.3.5 receipt attribute"
            >Â§ 6.4.3.5 receipt attribute</a
          >
        </li>
        <li>
          <a
            href="#ref-for-dom-monetizationprogresseventinit-receipt-2"
            title="Â§ 6.4.3.6 MonetizationProgressEventInit dictionary"
            >Â§ 6.4.3.6 MonetizationProgressEventInit dictionary</a
          >
        </li>
      </ul>
    </div>
    <script id="respec-dfn-panel">
      ;(() => {
        // @ts-check
        if (document.respec) {
          document.respec.ready.then(setupPanel)
        } else {
          setupPanel()
        }

        function setupPanel() {
          const listener = panelListener()
          document.body.addEventListener('keydown', listener)
          document.body.addEventListener('click', listener)
        }

        function panelListener() {
          /** @type {HTMLElement} */
          let panel = null
          return (event) => {
            const { target, type } = event

            if (!(target instanceof HTMLElement)) return

            // For keys, we only care about Enter key to activate the panel
            // otherwise it's activated via a click.
            if (type === 'keydown' && event.key !== 'Enter') return

            const action = deriveAction(event)

            switch (action) {
              case 'show': {
                hidePanel(panel)
                /** @type {HTMLElement} */
                const dfn = target.closest('dfn, .index-term')
                panel = document.getElementById(`dfn-panel-for-${dfn.id}`)
                const coords = deriveCoordinates(event)
                displayPanel(dfn, panel, coords)
                break
              }
              case 'dock': {
                panel.style.left = null
                panel.style.top = null
                panel.classList.add('docked')
                break
              }
              case 'hide': {
                hidePanel(panel)
                panel = null
                break
              }
            }
          }
        }

        /**
         * @param {MouseEvent|KeyboardEvent} event
         */
        function deriveCoordinates(event) {
          const target = /** @type HTMLElement */ (event.target)

          // We prevent synthetic AT clicks from putting
          // the dialog in a weird place. The AT events sometimes
          // lack coordinates, so they have clientX/Y = 0
          const rect = target.getBoundingClientRect()
          if (
            event instanceof MouseEvent &&
            event.clientX >= rect.left &&
            event.clientY >= rect.top
          ) {
            // The event probably happened inside the bounding rect...
            return { x: event.clientX, y: event.clientY }
          }

          // Offset to the middle of the element
          const x = rect.x + rect.width / 2
          // Placed at the bottom of the element
          const y = rect.y + rect.height
          return { x, y }
        }

        /**
         * @param {Event} event
         */
        function deriveAction(event) {
          const target = /** @type {HTMLElement} */ (event.target)
          const hitALink = !!target.closest('a')
          if (target.closest('dfn:not([data-cite]), .index-term')) {
            return hitALink ? 'none' : 'show'
          }
          if (target.closest('.dfn-panel')) {
            if (hitALink) {
              return target.classList.contains('self-link') ? 'hide' : 'dock'
            }
            const panel = target.closest('.dfn-panel')
            return panel.classList.contains('docked') ? 'hide' : 'none'
          }
          if (document.querySelector('.dfn-panel:not([hidden])')) {
            return 'hide'
          }
          return 'none'
        }

        /**
         * @param {HTMLElement} dfn
         * @param {HTMLElement} panel
         * @param {{ x: number, y: number }} clickPosition
         */
        function displayPanel(dfn, panel, { x, y }) {
          panel.hidden = false
          // distance (px) between edge of panel and the pointing triangle (caret)
          const MARGIN = 20

          const dfnRects = dfn.getClientRects()
          // Find the `top` offset when the `dfn` can be spread across multiple lines
          let closestTop = 0
          let minDiff = Infinity
          for (const rect of dfnRects) {
            const { top, bottom } = rect
            const diffFromClickY = Math.abs((top + bottom) / 2 - y)
            if (diffFromClickY < minDiff) {
              minDiff = diffFromClickY
              closestTop = top
            }
          }

          const top = window.scrollY + closestTop + dfnRects[0].height
          const left = x - MARGIN
          panel.style.left = `${left}px`
          panel.style.top = `${top}px`

          // Find if the panel is flowing out of the window
          const panelRect = panel.getBoundingClientRect()
          const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width)
          if (panelRect.right > SCREEN_WIDTH) {
            const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width)
            const newCaretOffset = left - newLeft
            panel.style.left = `${newLeft}px`
            /** @type {HTMLElement} */
            const caret = panel.querySelector('.caret')
            caret.style.left = `${newCaretOffset}px`
          }

          // As it's a dialog, we trap focus.
          // TODO: when <dialog> becomes a implemented, we should really
          // use that.
          trapFocus(panel, dfn)
        }

        /**
         * @param {HTMLElement} panel
         * @param {HTMLElement} dfn
         * @returns
         */
        function trapFocus(panel, dfn) {
          /** @type NodeListOf<HTMLAnchorElement> elements */
          const anchors = panel.querySelectorAll('a[href]')
          // No need to trap focus
          if (!anchors.length) return

          // Move focus to first anchor element
          const first = anchors.item(0)
          first.focus()

          const trapListener = createTrapListener(anchors, panel, dfn)
          panel.addEventListener('keydown', trapListener)

          // Hiding the panel releases the trap
          const mo = new MutationObserver((records) => {
            const [record] = records
            const target = /** @type HTMLElement */ (record.target)
            if (target.hidden) {
              panel.removeEventListener('keydown', trapListener)
              mo.disconnect()
            }
          })
          mo.observe(panel, { attributes: true, attributeFilter: ['hidden'] })
        }

        /**
         *
         * @param {NodeListOf<HTMLAnchorElement>} anchors
         * @param {HTMLElement} panel
         * @param {HTMLElement} dfn
         * @returns
         */
        function createTrapListener(anchors, panel, dfn) {
          const lastIndex = anchors.length - 1
          let currentIndex = 0
          return (event) => {
            switch (event.key) {
              // Hitting "Tab" traps us in a nice loop around elements.
              case 'Tab': {
                event.preventDefault()
                currentIndex += event.shiftKey ? -1 : +1
                if (currentIndex < 0) {
                  currentIndex = lastIndex
                } else if (currentIndex > lastIndex) {
                  currentIndex = 0
                }
                anchors.item(currentIndex).focus()
                break
              }

              // Hitting "Enter" on an anchor releases the trap.
              case 'Enter':
                hidePanel(panel)
                break

              // Hitting "Escape" returns focus to dfn.
              case 'Escape':
                hidePanel(panel)
                dfn.focus()
                return
            }
          }
        }

        /** @param {HTMLElement} panel */
        function hidePanel(panel) {
          if (!panel) return
          panel.hidden = true
          panel.classList.remove('docked')
        }
      })()
    </script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  </body>
</html>
