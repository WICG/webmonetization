<!DOCTYPE html>
<html>
  <head>
    <title>Exclusive Content Demo</title>
    <link
      id="favicon"
      rel="icon"
      href="https://img.icons8.com/ios-glyphs/344/exclusive-product.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="skeleton.css" />
    <link rel="stylesheet" href="normalize.css" />
    <link rel="stylesheet" href="style.css" />

    <script src="./wm-previewer.js"></script>
  </head>
  <body>
    <div class="container">
      <h3>Web Monetization Demo</h3>
      <h1>Exclusive Content using the Exclusive Content Generator</h1>

      <div>
        <p>
          This page includes exclusive content that has been generated using the
          <a href="https://webmonetization.org/exclusive-content"
            >Exclusive Content Generator</a
          >.
        </p>
      </div>

      <div>
        <h4>
          Example 1: Simple text
        </h4>
        <p>
          Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
          nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
          sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
          rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
          ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
          sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
          dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
          et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
          takimata sanctus est Lorem ipsum dolor sit amet.
        </p>
        <div
          class="exclusive"
          id="ntqvw1ggo0h"
          paymentpointer="$ilp.uphold.com/PL6pBi7GKNBe"
          proxypaymentpointer="https://receipt-verifier-dehz6dtlzq-uc.a.run.app/%24ilp.uphold.com%2FPL6pBi7GKNBe"
          cyphertext="WcdXJUq6djM2W7SNHBd8hVLVDVuOJx2LQ5Qdzes0wxbpZtj55mFA3nF+ukjxSP/pZlLbWQXKY9EDze+EJjZOaYroefq4SGxEFgzboiHkFRt40A00vcPw3i5+EaqLil40y+HuzTT83Zujcvbh0TKXW11aDWLk2CBvcgI0VQvmVt+8T7msWtyIZdFIq3PGgRO9nnpx1wI27Skt0OfX2WSBHC9mVh20X59hgYJ5F1+Y8WRDb2cTN6O8xotpbvHaBiFahkYKpY82nkVuA/eDT2r6RZOoe6gaRcIex5L6ZnmmTNENiUoSOWTzM18UT+rixnP2MH1rzIPUJnGpVkTxyFp9iHP/Hc0oKjGlAelo8GoXbnZNKUkk5+eN/yQV3Xvin0+Mb+AeqTCEBJtamTd0hinxMfmWvcBC6XHaed8hTniUzWoLASStFxr233sU8iv4uTRLoslRB8VToFYhGCK/1SYEg/N5ofp7fE5M+N7mFGpjBM+3qV9Dh5EBJpx09QjriJsc9Md10J1AMwjKpTWeYWYxYd/PF6ZkGN61TUTDtEjyXSOxSp76WMChNy0sdcOZwp2olTwFvXhdEa3ArFemyxyjv1qG+pQWgVo9h6mfp3/tt5O5LZnP3nCVnCLefB1dwH9WWaW1e0kovay5z2KWeZHJzbZNEpe7rxXykerTwvTNd0zsHJ4aF7BdO6HK5xpRqZBqibG72lyH1I89dBKIrSfmu8PWsWbCuePEwnsdY3Hf/l+5wfNvpkPLMdyKT3AFb4unyuxiFqDo2JxBX9Slj0fsRuD/9vfBkXjyI1lWL6fVCzw="
          cypherverifier="fdxRMFSgMGw3S7rIEQhkx1aQDFucbhmUC4RUhfJtyRHgaMyg5nBOzD5oplasSub3+MDIFk1EKmZV5rvPLFkekA=="
          initvector="UruotwZEfsHF1cHZiu0yuw=="
          nonce="eIZBPCBtlxyGs7hSRHZblA=="
          plaintext="Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
          nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
          sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
          rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
          ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
          sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
          dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
          et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
          takimata sanctus est Lorem ipsum dolor sit amet."
        >
          <div class="exclusiveMessage" style="text-align: center"></div>
          <div class="exclusiveContent"></div>
        </div>
      </div>
      <br />
      <div>
        <h4>
          Example 2: HTML
        </h4>
        <pre><code>
&lt;h5&gt;
  This is HTML
&lt;/h5&gt;
&lt;p&gt;
  Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
  nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
  sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
  rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
  ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
  sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
  dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
  et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
  takimata sanctus est Lorem ipsum dolor sit amet.
&lt;/p&gt;
        </code></pre>
        <div
          class="exclusive"
          id="fea27nosj2w"
          paymentpointer="$ilp.uphold.com/PL6pBi7GKNBe"
          proxypaymentpointer="https://receipt-verifier-dehz6dtlzq-uc.a.run.app/%24ilp.uphold.com%2FPL6pBi7GKNBe"
          cyphertext="l4sAXtAIDsYrZREtw25eKJ2tvWggmHYjvudk0vja0Kt4oLv1PrlK5HwduIPX9t1UAfinEGkTL6fbf0BEb8tIJQ5+x+wsqB8+bszS70nZMbeWzFgAU0n67S8P1PlfY1ciDtd1qrHyk5rPuufUs/6VaqniyFswf5IsWDLSiahHqLNDSn9RF3cUtNDFhetupW+sfRrX5QAnIqmcFg15JKTi3AUPzrje51I0UKuF2doPqzds7dFuaCSJxlStJ/OrQ80DW9RKEf77sQG/0hIaTGP9K/2lxXjn0Pi0tgdqbOcLnOSvLtv2UXbA2VP9ClnsfepwlA94zGZk4XHyQbWsJDfjxQngfaJyU3ThRhfj1rXqCIVIShDXtn+tcSug6tm3gGhPEezoX/vEUVIyTzzKyTu047662WbAf9SUqlvh+G427g4VZzQWqzzQjOVrOgv+5eNsLMkBmCdpNSaP6k5pc/Ny23NGncYAWTIFV5FHG9iQxx6DyDADREl9yV8ohC6VCwNTwwrHZcIz6QwRnbfxzKwFckA5pGyo5SBIYioQjNAjHFbi2jcnJrMjFc7VTcl0bneEpJx8rNi+rTP+zdkYIIbnpgSoXNnDUYkRSnG6e2vrbkWjq1FH9pyFHdxsUUNaLXbp+b5EQ4S3/kDoD7wVmJPlh+u7x3YXezziDBvVRbo6tLn/iwpYk4rTbZCan+8zn/3WwMSYM8LzQdaRbKw7nnd+B0fqM/ZPTaRpOWDpXSewDe1ugDPWdNdczDh1oT2qfcKLEPnSybPQh5snZRFe1UkIvcuUc58HTE+ktpCvBVqa5WzZyWFSfFNsWVfuc1cAEx+MKA4MHfmm8LjT+JecYVw0bU/3TAXXiPT24sL5AOR4j8y1hJy/"
          cypherverifier="w5dBEKkSAb0xaQFow20KTb+Fgwt63ntkrYk9yrzmlP9Ytbi9JvoN9SEaoM2d+MFLKK5+wvBd9y6wgIvSORRbPQ=="
          initvector="DsBQAD+2BXOCPIGgAmOV8w=="
          nonce="fgwusVkCzjkFh3z22m2UyA=="
          plaintext="<h5>This is HTML</h5>
          <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
          nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
          sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
          rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
          ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
          sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
          dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
          et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
          takimata sanctus est Lorem ipsum dolor sit amet.</p>"
        >
          <div class="exclusiveMessage" style="text-align: center"></div>
          <div class="exclusiveContent"></div>
        </div>
      </div>
      <div>
        <h4>
          Example 3: Multimedia Link
        </h4>
        <pre><code>
&lt;iframe 
  src="https://archive.org/embed/subprime-attention-crisis" 
  width="640" 
  height="480" 
  frameborder="0" 
  webkitallowfullscreen="true" 
  mozallowfullscreen="true" 
  allowfullscreen
  allow="monetization"
&gt;&lt;/iframe&gt;
      </code></pre>
        <div
          class="exclusive"
          id="aa5rqdu4e53a"
          paymentpointer="$ilp.uphold.com/D7BwPKMQzBiD"
          proxypaymentpointer="https://receipt-verifier-dehz6dtlzq-uc.a.run.app/%24ilp.uphold.com%2FD7BwPKMQzBiD"
          cyphertext="gcD7yD/Msid0QJSGo1vP3pJX9wiUPpEQToWlrDcVRE/V8hvdQ6ZKatOnvB1f/tF8jZ+uktP/Cqbx+JGz7LMEEcxaeqhkccrZlzwOqFs8zkJVkXTKpZN6r9O/j+d33Fxq9Sq8NkIqJJixtmYEbQC+Lc/HnH1X3p9dHV+DMCk/jn/YNfv1Oy8YaV04qh5wD0GI+V1T/Cdlhk5qX3yCNneWYbe7UaxwerREF8r4ZAe4TaJ8sET52hH5Jyf7nG6EmY99P419IG838aD402+Y8Na5KUdFMN3LZJB4yrmhmLsrcUK1tgiMIi0d433CLx1SwncRohkG4hOx1ts="
          cypherverifier="1d3pyi2b+CgMBdeQuEiG0YxG8RGBbdtNApOjrCRVRRXW+g3fU6gGbpn6ugYT79NlBydDH4NeX3Q1kY6f19uB4A=="
          initvector="STpEthIz0J8YvzDrXWzRfQ=="
          nonce="Rv0e26i/dJaSGuPZh9VdvA=="
          plaintext="<iframe src='https://archive.org/embed/subprime-attention-crisis' width='640' height='480' frameborder='0' webkitallowfullscreen='true' mozallowfullscreen='true' allowfullscreenallow='monetization'></iframe>"
        >
          <div class="exclusiveMessage" style="text-align: center"></div>
          <div class="exclusiveContent"></div>
        </div>
      </div>
    </div>

    <footer>
      Made with ❤️ by
      <a href="https://coil.com/u/sabinebertram">Sabine Bertram</a> @
      <a href="https://coil.com/">Coil</a>.
    </footer>

    <script>
      const WORKER = "https://webmonetization.org/api/exclusive-content";

      function exclusiveContent() {
        const { data, paymentPointer } = gatherExclusive();

        if (document.monetization !== undefined) {
          setMeta(paymentPointer);

          document.monetization.addEventListener("monetizationpending", () => {
            if (data.length) {
              document
                .querySelectorAll(".exclusiveMessage")
                .forEach(element => {
                  element.innerHTML =
                    "<p>⸻ ⏰ Waiting for Web Monetization to start to unlock this content. ⸻</p>";
                });
            }
          });

          document.monetization.addEventListener("monetizationstart", () => {
            if (data.length) {
              document
                .querySelectorAll(".exclusiveMessage")
                .forEach(element => {
                  element.innerHTML =
                    "<p>⸻ ⏰ Waiting for Web Monetization receipt verification to unlock this content. ⸻</p>";
                });
            }
          });

          document.monetization.addEventListener(
            "monetizationprogress",
            event => {
              if (data.length) {
                unlockExclusiveContent(data.pop());
              }
            }
          );
        } else {
          document.querySelectorAll(".exclusiveMessage").forEach(element => {
            element.innerHTML =
              "<p>⸻ 🔒 This content is exclusive for users with Web Monetization enabled. ⸻</p>";
          });
        }
      }

      function gatherExclusive() {
        const data = [];
        const pointers = [];
        document.querySelectorAll(".exclusive").forEach(element => {
          data.push({
            id: element.getAttribute("id"),
            paymentPointer: element.getAttribute("paymentpointer"),
            cypherText: element.getAttribute("cyphertext"),
            cypherVerifier: element.getAttribute("cypherverifier"),
            initVector: element.getAttribute("initvector"),
            nonce: element.getAttribute("nonce"),
            plainText: element.getAttribute("plaintext")
          });
          pointers.push(element.getAttribute("proxypaymentpointer"));
        });
        const paymentPointer =
          pointers[Math.floor(Math.random() * pointers.length)];
        return { data, paymentPointer };
      }

      function setMeta(proxyPaymentPointer) {
        const meta = document.createElement("meta");
        meta.name = "monetization";
        meta.content = proxyPaymentPointer;
        document.getElementsByTagName("head")[0].appendChild(meta);
      }

      function unlockExclusiveContent(data) {
        const element = document.querySelector(`#${data.id}`);
        element.querySelector(".exclusiveMessage").innerHTML =
          "<p>⸻ 🔓 Enjoy your exclusive content! ⸻</p>";
        element.querySelector(".exclusiveContent").innerHTML = data.plainText;
      }

      exclusiveContent();
    </script>
  </body>
</html>
