---
id: api
title: JavaScript API
sidebar_label: JavaScript API
---

This JavaScript browser API allows Web-monetized websites to request small
payments from users. Payments are facilitated by the user's browser and
[Web Monetization provider](/#providers).

> No files are needed to use this API.

This API is injected by any browser or extension that supports Web Monetization.

> This document represents the current API implementation. Note that an
[unofficial draft specification](../specification.html) suitable for the W3C
standards track is being developed and should **NOT** be used as a reference for
current implementations.

#### Assumptions

* Your website is [monetized](./getting-started).
* The user has an account with a Web Monetization sender.
* The user's browser supports Web Monetization natively or through an extension.

## Document.Monetization

The browser exposes the `document.monetization` DOM object that implements
`EventTarget` and has a read-only `state` property. The object allows you to
track Web Monetization events and see whether the user visiting your page is
Web monetized.

```ts
document.monetization: EventTarget
document.monetization.state: 'stopped' | 'pending' | 'started'
```

## States

Check the value of `document.monetization.state` to see if a user is Web
Monetized.

### `undefined`

Until Web Monetization is built into browsers, the `state` will be `undefined`
unless a polyfill is installed (e.g. a Web Monetization provider's browser
extension).

```ts
document.monetization === undefined
```

### `stopped`

The user is capable of Web Monetization but is not currently streaming payments.

If the user is Web-monetized, the `document.monetization.state` will always
begin in a `stopped` state.

```ts
document.monetization && document.monetization.state === 'stopped'
```

If a monetization tag is found and their Web Monetization provider is
enabled/active/etc., the `document.monetization.state` transitions to `pending`
as the payment stream is initiated.

### `pending`

The user is capable of Web Monetization. Their provider has initiated a payment
stream but no payments have been completed yet.

```ts
document.monetization && document.monetization.state === 'pending'
```

### `started`

The user is capable of Web Monetization and their provider is actively streaming
payments to the website.

```ts
document.monetization && document.monetization.state === `started`
```

It can take a few seconds for the state to change from `pending` to `started`.
The events described below can be used to listen for a change in
`document.monetization.state`.

## Browser Events

### `monetizationpending`

Determine when Web Monetization is enabled by adding an event listener for
`monetizationpending` to `document.monetization`.

#### Event Listener

```ts
function pendingEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationpending', pendingEventHandler)
```

#### Event Object

| Field | Value | Details |
| ------ | ----- | ------ |
| paymentPointer | String | Your payment account ID. The same value is used as the `content` in your `<meta>` tag.|
| requestId | String | This value is identical to the session ID/Monetization ID (UUID v4) generated by the user agent (see [Flow](/docs/explainer#flow)).|

#### Example Event Object

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
  }
}
```

### `monetizationstart`

Determine when Web Monetization has started actively paying by adding an event
listener for `monetizationstart` to `document.monetization`.

#### Event Listener

```ts
function startEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationstart', startEventHandler)
```

#### Event Object

| Field | Value | Details |
| ------ | ----- | ------ |
| paymentPointer | String | Your payment account ID. The same value is used as the `content` in your `<meta>` tag.|
| requestId | String | This value is identical to the session ID/Monetization ID (UUID v4) generated by the user agent (see [Flow](/docs/explainer#flow)).|

#### Example Event Object

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
  }
}
```

### `monetizationstop`

Determine when Web Monetization has stopped by adding an event listener for
`monetizationstop` to `document.monetization`.

#### Event Listener

```ts
function stopEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationstop', stopEventHandler)
```

#### Event Object

| Field | Value | Details |
| ------ | ----- | ------ |
| paymentPointer | String | Your payment account ID. The same value is used as the `content` in your `<meta>` tag.|
| requestId | String | This value is identical to the session ID/Monetization ID (UUID v4) generated by the user agent (see [Flow](/docs/explainer#flow)).|

#### Example Event Object

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
  }
}
```

### `monetizationprogress`

Determine the current status of the payment stream by adding an event listener
for `monetizationprogress` to `document.monetization`.

#### Event Listener

```ts
function progressEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationprogress', progressEventHandler)
```

#### Event Object

| Field | Value | Details |
| ----- | ----- | ------- |
| paymentPointer | String | Your payment account ID. The same value is used as the `content` in your `<meta>` tag.|
| requestId | String | This value is identical to the session ID/Monetization ID (UUID v4) generated by the user agent (see [Flow](/docs/explainer#flow)).|
|amount | String | The destination amount received as specified in the Interledger Protocol (ILP) packet. |
|assetCode | String | The code (typically three characters) identifying the amount's unit. A unit, for example, could be a currency (USD, XRP). |
|assetScale | Number | The number of places past the decimal for the amount. For example, if you have USD with an asset scale of two, then the minimum divisible unit is cents. |

#### Example Event Object

In this example, the total amount of XRP received is equal to 75673 Ã— 10^-9
(0.000075673).

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
    amount: "75673",
    assetCode: "XRP",
    assetScale: 9
  }
}
```

## HTTP Headers

### `Web-Monetization-Id`

The `Web-Monetization-Id` header contains the Monetization ID (UUID v4)
generated by the browser. The Monetization ID is identical to the session ID and
the `requestId` in the `monetizationstart` browser event.

> The header **MUST ALWAYS** be sent on SPSP queries for Web Monetization and
**MUST** be a UUID v4.

#### Example Header

```http
Web-Monetization-Id: dcd479ad-7d8d-4210-956a-13c14b8c67eb
```
