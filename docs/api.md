---
id: api
title: API
sidebar_label: API
---

If a user visits your page and has Web Monetization enabled, your site can
detect that Web Monetization is enabled.

You can access Web Monetization related events and state through a Javascript
API on `document.monetization`.

## Javascript API
```ts
document.monetization: EventTarget
document.monetization.state: 'stopped' | 'pending' | 'started'
```

This Javascript API is injected by any browser or extension that supports Web
Monetization.

> You don't need to include any files to use this Javascript API.

Check the value of `document.monetization.state` to see if the user visiting
your page is Web Monetized.

There are 4 possible states for Web Monetization:

### No Web Monetization

```ts
document.monetization === undefined
```

Until Web Monetization is built into the browser this will be `undefined` unless a polyfill is installed (e.g. a [Web Monetization Service Provider](/#providers) extension).

### Stopped

```ts
document.monetization && document.monetization.state === 'stopped'
```

The user's browser is capable of Web Monetization.
If a monetization tag is found **AND** the [Web Monetization Service Provider](/#providers) is enabled/active/etc the `document.monetization.state` will transition to `pending` as STREAMing is initiated.

If the user is Web Monetized, the `document.monetization.state` will always begin in this state.

### Pending

```ts
document.monetization && document.monetization.state === 'pending'
```

The user is capable of Web Monetization.
The [Web Monetization Service Provider](/#providers) has initiated a STREAMing payment with Interledger but no packet has been sent yet.

### Started

```ts
document.monetization && document.monetization.state === 'started'
```

The user is capable of Web Monetization. 
The [Web Monetization Service Provider](/#providers) is actively STREAMing payments to your site with Interledger.

It can take a couple of seconds for `document.monetization.state` to go from `pending` to `started`. The events described below can be used to listen for a change in `document.monetization.state`.

## Browser Events

### `monetizationpending`

```ts
function pendingEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationpending', pendingEventHandler)
```
*Event Object*

Field | Value | Details
--- | --- | ---
paymentPointer | String | The `paymentPointer` matches the one in the `<meta name="monetization">` tag.
requestId | String | The `requestId` matches the Monetization ID (UUID V4) generated by the browser (see [Flow](/docs/explainer#flow)).

*Example Event Object*

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
  }
}
```

The `monetizationpending` event can be listened to determine when Web Monetization has been initiated. To use it add an event listener to document.monetization.

### `monetizationstart`

```ts
function startEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationstart', startEventHandler)
```
*Event Object*

Field | Value | Details
--- | --- | ---
paymentPointer | String | The `paymentPointer` matches the one in the `<meta name="monetization">` tag.
requestId | String | The `requestId` matches the Monetization ID (UUID V4) generated by the browser (see [Flow](/docs/explainer#flow)).

*Example Event Object*

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
  }
}
```

The `monetizationstart` event can be listened to determine when Web Monetization has started actively paying. To use it add an event listener to document.monetization.

### `monetizationstop`

```ts
function stopEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationstop', stopEventHandler)
```
*Event Object*

Field | Value | Details
--- | --- | ---
paymentPointer | String | The `paymentPointer` matches the one in the `<meta name="monetization">` tag.
requestId | String | The `requestId` matches the Monetization ID (UUID V4) generated by the browser (see [Flow](/docs/explainer#flow)).

*Example Event Object*

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
  }
}
```

The `monetizationstop` event can be listened to determine when Web Monetization has been stopped. To use it add an event listener to document.monetization.

### `monetizationprogress`

```ts
function progressEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationprogress', progressEventHandler)
```

*Event Object*

Field | Value | Details
--- | --- | ---
paymentPointer | String | The `paymentPointer` matches the one in the `<meta name="monetization">` tag.
requestId | String | The `requestId` matches the Monetization ID (UUID V4) generated by the browser (see [Flow](/docs/explainer#flow)).
amount | String | String containing the destination amount received as specified in the ILP packet.
assetCode | String | The three letter asset code describing the amount's units.
assetScale | Number | A number representing the scale of the amount. For example, cents would have an assetScale of 2.

*Example Event Object*

```ts
{
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce"
    amount: "75673",
    assetCode: "XRP",
    assetScale: 9
  }
}
```

The `monetizationprogress` event can be listened to show the current status of the STREAMing payment. To use it add an event listener to document.monetization.

## HTTP Headers

### `Web-Monetization-Id`

Contains the `Monetization ID` (currently referred to as `requestId` in the events) that the browser generated. This header MUST always be sent on SPSP queries for Web Monetization. This value MUST be a UUID version 4.

```http
Web-Monetization-Id: dcd479ad-7d8d-4210-956a-13c14b8c67eb
```
